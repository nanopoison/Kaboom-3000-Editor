var Qe=Object.defineProperty;var Os=Object.getOwnPropertyDescriptor;var Rs=Object.getOwnPropertyNames;var Ps=Object.prototype.hasOwnProperty;var Ds=(i,n,a)=>n in i?Qe(i,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[n]=a;var l=(i,n)=>Qe(i,"name",{value:n,configurable:!0});var Bn=(i,n)=>{for(var a in n)Qe(i,a,{get:n[a],enumerable:!0})},Ms=(i,n,a,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let b of Rs(n))!Ps.call(i,b)&&b!==a&&Qe(i,b,{get:()=>n[b],enumerable:!(o=Os(n,b))||o.enumerable});return i};var Fs=i=>Ms(Qe({},"__esModule",{value:!0}),i);var Q=(i,n,a)=>(Ds(i,typeof n!="symbol"?n+"":n,a),a);var Bs=(()=>{for(var i=new Uint8Array(128),n=0;n<64;n++)i[n<26?n+65:n<52?n+71:n<62?n-4:n*4-205]=n;return a=>{for(var o=a.length,b=new Uint8Array((o-(a[o-1]=="=")-(a[o-2]=="="))*3/4|0),E=0,B=0;E<o;){var g=i[a.charCodeAt(E++)],O=i[a.charCodeAt(E++)],F=i[a.charCodeAt(E++)],T=i[a.charCodeAt(E++)];b[B++]=g<<2|O>>4,b[B++]=O<<4|F>>2,b[B++]=F<<6|T}return b}})();var uo={};Bn(uo,{default:()=>ao});module.exports=Fs(uo);function ce(i){return i*Math.PI/180}l(ce,"deg2rad");function mt(i){return i*180/Math.PI}l(mt,"rad2deg");function re(i,n,a){return n>a?re(i,a,n):Math.min(Math.max(i,n),a)}l(re,"clamp");function Ge(i,n,a){return i+(n-i)*a}l(Ge,"lerp");function pt(i,n,a,o,b){return o+(i-n)/(a-n)*(b-o)}l(pt,"map");function In(i,n,a,o,b){return re(pt(i,n,a,o,b),o,b)}l(In,"mapc");var X=class{x=0;y=0;constructor(n=0,a=n){this.x=n,this.y=a}static fromAngle(n){let a=ce(n);return new X(Math.cos(a),Math.sin(a))}clone(){return new X(this.x,this.y)}add(...n){let a=v(...n);return new X(this.x+a.x,this.y+a.y)}sub(...n){let a=v(...n);return new X(this.x-a.x,this.y-a.y)}scale(...n){let a=v(...n);return new X(this.x*a.x,this.y*a.y)}dist(...n){let a=v(...n);return this.sub(a).len()}sdist(...n){let a=v(...n);return this.sub(a).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let n=this.len();return n===0?new X(0):this.scale(1/n)}normal(){return new X(this.y,-this.x)}reflect(n){return this.sub(n.scale(2*this.dot(n)))}project(n){return n.scale(n.dot(this)/n.len())}reject(n){return this.sub(this.project(n))}dot(n){return this.x*n.x+this.y*n.y}cross(n){return this.x*n.y-this.y*n.x}angle(...n){let a=v(...n);return mt(Math.atan2(this.y-a.y,this.x-a.x))}angleBetween(...n){let a=v(...n);return mt(Math.atan2(this.cross(a),this.dot(a)))}lerp(n,a){return new X(Ge(this.x,n.x,a),Ge(this.y,n.y,a))}slerp(n,a){let o=this.dot(n),b=this.cross(n),E=Math.atan2(b,o);return this.scale(Math.sin((1-a)*E)).add(n.scale(Math.sin(a*E))).scale(1/b)}isZero(){return this.x===0&&this.y===0}toFixed(n){return new X(Number(this.x.toFixed(n)),Number(this.y.toFixed(n)))}transform(n){return n.multVec2(this)}eq(n){return this.x===n.x&&this.y===n.y}bbox(){return new V(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},w=X;l(w,"Vec2"),Q(w,"LEFT",new X(-1,0)),Q(w,"RIGHT",new X(1,0)),Q(w,"UP",new X(0,-1)),Q(w,"DOWN",new X(0,1));function v(...i){if(i.length===1){if(i[0]instanceof w)return new w(i[0].x,i[0].y);if(Array.isArray(i[0])&&i[0].length===2)return new w(...i[0])}return new w(...i)}l(v,"vec2");var ue=class{r=255;g=255;b=255;constructor(n,a,o){this.r=re(n,0,255),this.g=re(a,0,255),this.b=re(o,0,255)}static fromArray(n){return new ue(n[0],n[1],n[2])}static fromHex(n){if(typeof n=="number")return new ue(n>>16&255,n>>8&255,n>>0&255);{let a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return new ue(parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16))}}static fromHSL(n,a,o){if(a==0)return S(255*o,255*o,255*o);let b=l((T,R,D)=>(D<0&&(D+=1),D>1&&(D-=1),D<1/6?T+(R-T)*6*D:D<1/2?R:D<2/3?T+(R-T)*(2/3-D)*6:T),"hue2rgb"),E=o<.5?o*(1+a):o+a-o*a,B=2*o-E,g=b(B,E,n+1/3),O=b(B,E,n),F=b(B,E,n-1/3);return new ue(Math.round(g*255),Math.round(O*255),Math.round(F*255))}clone(){return new ue(this.r,this.g,this.b)}lighten(n){return new ue(this.r+n,this.g+n,this.b+n)}darken(n){return this.lighten(-n)}invert(){return new ue(255-this.r,255-this.g,255-this.b)}mult(n){return new ue(this.r*n.r/255,this.g*n.g/255,this.b*n.b/255)}eq(n){return this.r===n.r&&this.g===n.g&&this.b===n.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},C=ue;l(C,"Color"),Q(C,"RED",S(255,0,0)),Q(C,"GREEN",S(0,255,0)),Q(C,"BLUE",S(0,0,255)),Q(C,"YELLOW",S(255,255,0)),Q(C,"MAGENTA",S(255,0,255)),Q(C,"CYAN",S(0,255,255)),Q(C,"WHITE",S(255,255,255)),Q(C,"BLACK",S(0,0,0));function S(...i){if(i.length===0)return new C(255,255,255);if(i.length===1){if(i[0]instanceof C)return i[0].clone();if(Array.isArray(i[0])&&i[0].length===3)return C.fromArray(i[0])}return new C(...i)}l(S,"rgb");var Gn=l((i,n,a)=>C.fromHSL(i,n,a),"hsl2rgb"),G=class{x=0;y=0;w=1;h=1;constructor(n,a,o,b){this.x=n,this.y=a,this.w=o,this.h=b}scale(n){return new G(this.x+this.w*n.x,this.y+this.h*n.y,this.w*n.w,this.h*n.h)}clone(){return new G(this.x,this.y,this.w,this.h)}eq(n){return this.x===n.x&&this.y===n.y&&this.w===n.w&&this.h===n.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};l(G,"Quad");function Vn(i,n,a,o){return new G(i,n,a,o)}l(Vn,"quad");var I=class{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(n){n&&(this.m=n)}static translate(n){return new I([1,0,0,0,0,1,0,0,0,0,1,0,n.x,n.y,0,1])}static scale(n){return new I([n.x,0,0,0,0,n.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(n){n=ce(-n);let a=Math.cos(n),o=Math.sin(n);return new I([1,0,0,0,0,a,-o,0,0,o,a,0,0,0,0,1])}static rotateY(n){n=ce(-n);let a=Math.cos(n),o=Math.sin(n);return new I([a,0,o,0,0,1,0,0,-o,0,a,0,0,0,0,1])}static rotateZ(n){n=ce(-n);let a=Math.cos(n),o=Math.sin(n);return new I([a,-o,0,0,o,a,0,0,0,0,1,0,0,0,0,1])}translate(n){return this.m[12]+=this.m[0]*n.x+this.m[4]*n.y,this.m[13]+=this.m[1]*n.x+this.m[5]*n.y,this.m[14]+=this.m[2]*n.x+this.m[6]*n.y,this.m[15]+=this.m[3]*n.x+this.m[7]*n.y,this}scale(n){return this.m[0]*=n.x,this.m[4]*=n.y,this.m[1]*=n.x,this.m[5]*=n.y,this.m[2]*=n.x,this.m[6]*=n.y,this.m[3]*=n.x,this.m[7]*=n.y,this}rotate(n){n=ce(-n);let a=Math.cos(n),o=Math.sin(n),b=this.m[0],E=this.m[1],B=this.m[4],g=this.m[5];return this.m[0]=b*a+E*o,this.m[1]=-b*o+E*a,this.m[4]=B*a+g*o,this.m[5]=-B*o+g*a,this}mult(n){let a=[];for(let o=0;o<4;o++)for(let b=0;b<4;b++)a[o*4+b]=this.m[0*4+b]*n.m[o*4+0]+this.m[1*4+b]*n.m[o*4+1]+this.m[2*4+b]*n.m[o*4+2]+this.m[3*4+b]*n.m[o*4+3];return new I(a)}multVec2(n){return new w(n.x*this.m[0]+n.y*this.m[4]+this.m[12],n.x*this.m[1]+n.y*this.m[5]+this.m[13])}invert(){let n=[],a=this.m[10]*this.m[15]-this.m[14]*this.m[11],o=this.m[9]*this.m[15]-this.m[13]*this.m[11],b=this.m[9]*this.m[14]-this.m[13]*this.m[10],E=this.m[8]*this.m[15]-this.m[12]*this.m[11],B=this.m[8]*this.m[14]-this.m[12]*this.m[10],g=this.m[8]*this.m[13]-this.m[12]*this.m[9],O=this.m[6]*this.m[15]-this.m[14]*this.m[7],F=this.m[5]*this.m[15]-this.m[13]*this.m[7],T=this.m[5]*this.m[14]-this.m[13]*this.m[6],R=this.m[4]*this.m[15]-this.m[12]*this.m[7],D=this.m[4]*this.m[14]-this.m[12]*this.m[6],x=this.m[5]*this.m[15]-this.m[13]*this.m[7],d=this.m[4]*this.m[13]-this.m[12]*this.m[5],z=this.m[6]*this.m[11]-this.m[10]*this.m[7],oe=this.m[5]*this.m[11]-this.m[9]*this.m[7],tt=this.m[5]*this.m[10]-this.m[9]*this.m[6],xe=this.m[4]*this.m[11]-this.m[8]*this.m[7],Se=this.m[4]*this.m[10]-this.m[8]*this.m[6],nt=this.m[4]*this.m[9]-this.m[8]*this.m[5];n[0]=this.m[5]*a-this.m[6]*o+this.m[7]*b,n[4]=-(this.m[4]*a-this.m[6]*E+this.m[7]*B),n[8]=this.m[4]*o-this.m[5]*E+this.m[7]*g,n[12]=-(this.m[4]*b-this.m[5]*B+this.m[6]*g),n[1]=-(this.m[1]*a-this.m[2]*o+this.m[3]*b),n[5]=this.m[0]*a-this.m[2]*E+this.m[3]*B,n[9]=-(this.m[0]*o-this.m[1]*E+this.m[3]*g),n[13]=this.m[0]*b-this.m[1]*B+this.m[2]*g,n[2]=this.m[1]*O-this.m[2]*F+this.m[3]*T,n[6]=-(this.m[0]*O-this.m[2]*R+this.m[3]*D),n[10]=this.m[0]*x-this.m[1]*R+this.m[3]*d,n[14]=-(this.m[0]*T-this.m[1]*D+this.m[2]*d),n[3]=-(this.m[1]*z-this.m[2]*oe+this.m[3]*tt),n[7]=this.m[0]*z-this.m[2]*xe+this.m[3]*Se,n[11]=-(this.m[0]*oe-this.m[1]*xe+this.m[3]*nt),n[15]=this.m[0]*tt-this.m[1]*Se+this.m[2]*nt;let Et=this.m[0]*n[0]+this.m[1]*n[4]+this.m[2]*n[8]+this.m[3]*n[12];for(let fe=0;fe<4;fe++)for(let Ne=0;Ne<4;Ne++)n[fe*4+Ne]*=1/Et;return new I(n)}clone(){return new I([...this.m])}toString(){return this.m.toString()}};l(I,"Mat4");function kt(i,n,a,o=Math.sin){return i+(o(a)+1)/2*(n-i)}l(kt,"wave");var Ls=1103515245,Is=12345,Ln=2147483648,Ie=class{seed;constructor(n){this.seed=n}gen(){return this.seed=(Ls*this.seed+Is)%Ln,this.seed/Ln}genNumber(n,a){return n+this.gen()*(a-n)}genVec2(n,a){return new w(this.genNumber(n.x,a.x),this.genNumber(n.y,a.y))}genColor(n,a){return new C(this.genNumber(n.r,a.r),this.genNumber(n.g,a.g),this.genNumber(n.b,a.b))}genAny(...n){if(n.length===0)return this.gen();if(n.length===1){if(typeof n[0]=="number")return this.genNumber(0,n[0]);if(n[0]instanceof w)return this.genVec2(v(0,0),n[0]);if(n[0]instanceof C)return this.genColor(S(0,0,0),n[0])}else if(n.length===2){if(typeof n[0]=="number"&&typeof n[1]=="number")return this.genNumber(n[0],n[1]);if(n[0]instanceof w&&n[1]instanceof w)return this.genVec2(n[0],n[1]);if(n[0]instanceof C&&n[1]instanceof C)return this.genColor(n[0],n[1])}}};l(Ie,"RNG");var jt=new Ie(Date.now());function jn(i){return i!=null&&(jt.seed=i),jt.seed}l(jn,"randSeed");function Ze(...i){return jt.genAny(...i)}l(Ze,"rand");function _t(...i){return Math.floor(Ze(...i))}l(_t,"randi");function kn(i){return Ze()<=i}l(kn,"chance");function _n(i){return i[_t(i.length)]}l(_n,"choose");function Nn(i,n){return i.pos.x+i.width>n.pos.x&&i.pos.x<n.pos.x+n.width&&i.pos.y+i.height>n.pos.y&&i.pos.y<n.pos.y+n.height}l(Nn,"testRectRect");function Gs(i,n){if(i.p1.x===i.p2.x&&i.p1.y===i.p2.y||n.p1.x===n.p2.x&&n.p1.y===n.p2.y)return null;let a=(n.p2.y-n.p1.y)*(i.p2.x-i.p1.x)-(n.p2.x-n.p1.x)*(i.p2.y-i.p1.y);if(a===0)return null;let o=((n.p2.x-n.p1.x)*(i.p1.y-n.p1.y)-(n.p2.y-n.p1.y)*(i.p1.x-n.p1.x))/a,b=((i.p2.x-i.p1.x)*(i.p1.y-n.p1.y)-(i.p2.y-i.p1.y)*(i.p1.x-n.p1.x))/a;return o<0||o>1||b<0||b>1?null:o}l(Gs,"testLineLineT");function Le(i,n){let a=Gs(i,n);return a?v(i.p1.x+a*(i.p2.x-i.p1.x),i.p1.y+a*(i.p2.y-i.p1.y)):null}l(Le,"testLineLine");function Hn(i,n){if(Ve(i,n.p1)||Ve(i,n.p2))return!0;let a=i.points();return!!Le(n,new ne(a[0],a[1]))||!!Le(n,new ne(a[1],a[2]))||!!Le(n,new ne(a[2],a[3]))||!!Le(n,new ne(a[3],a[0]))}l(Hn,"testRectLine");function Ve(i,n){return n.x>i.pos.x&&n.x<i.pos.x+i.width&&n.y>i.pos.y&&n.y<i.pos.y+i.height}l(Ve,"testRectPoint");function qn(i,n){return i.center.sdist(n)<i.radius*i.radius}l(qn,"testCirclePoint");function $n(i,n){let a=!1,o=i.pts;for(let b=0,E=o.length-1;b<o.length;E=b++)o[b].y>n.y!=o[E].y>n.y&&n.x<(o[E].x-o[b].x)*(n.y-o[b].y)/(o[E].y-o[b].y)+o[b].x&&(a=!a);return a}l($n,"testPolygonPoint");var ne=class{p1;p2;constructor(n,a){this.p1=n.clone(),this.p2=a.clone()}transform(n){return new ne(n.multVec2(this.p1),n.multVec2(this.p2))}bbox(){return V.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new ne(this.p1,this.p2)}};l(ne,"Line");var V=class{pos;width;height;constructor(n,a,o){this.pos=n.clone(),this.width=a,this.height=o}static fromPoints(n,a){return new V(n.clone(),a.x-n.x,a.y-n.y)}center(){return new w(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(n){return new se(this.points().map(a=>n.multVec2(a)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new V(this.pos.clone(),this.width,this.height)}distToPoint(n){return Math.sqrt(this.sdistToPoint(n))}sdistToPoint(n){let a=this.pos,o=this.pos.add(this.width,this.height),b=Math.max(a.x-n.x,0,n.x-o.x),E=Math.max(a.y-n.y,0,n.y-o.y);return b*b+E*E}};l(V,"Rect");var de=class{center;radius;constructor(n,a){this.center=n.clone(),this.radius=a}transform(n){return new Ue(this.center,this.radius,this.radius).transform(n)}bbox(){return V.fromPoints(this.center.sub(v(this.radius)),this.center.add(v(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new de(this.center,this.radius)}};l(de,"Circle");var Ue=class{center;radiusX;radiusY;constructor(n,a,o){this.center=n.clone(),this.radiusX=a,this.radiusY=o}transform(n){return new Ue(n.multVec2(this.center),n.m[0]*this.radiusX,n.m[5]*this.radiusY)}bbox(){return V.fromPoints(this.center.sub(v(this.radiusX,this.radiusY)),this.center.add(v(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new Ue(this.center,this.radiusX,this.radiusY)}};l(Ue,"Ellipse");var se=class{pts;constructor(n){if(n.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=n}transform(n){return new se(this.pts.map(a=>n.multVec2(a)))}bbox(){let n=v(Number.MAX_VALUE),a=v(-Number.MAX_VALUE);for(let o of this.pts)n.x=Math.min(n.x,o.x),a.x=Math.max(a.x,o.x),n.y=Math.min(n.y,o.y),a.y=Math.max(a.y,o.y);return V.fromPoints(n,a)}area(){let n=0,a=this.pts.length;for(let o=0;o<a;o++){let b=this.pts[o],E=this.pts[(o+1)%a];n+=b.x*E.y*.5,n-=E.x*b.y*.5}return Math.abs(n)}clone(){return new se(this.pts.map(n=>n.clone()))}};l(se,"Polygon");function zn(i,n){let a=Number.MAX_VALUE,o=v(0);for(let b of[i,n])for(let E=0;E<b.pts.length;E++){let B=b.pts[E],O=b.pts[(E+1)%b.pts.length].sub(B).normal().unit(),F=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let d=0;d<i.pts.length;d++){let z=i.pts[d].dot(O);F=Math.min(F,z),T=Math.max(T,z)}let R=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(let d=0;d<n.pts.length;d++){let z=n.pts[d].dot(O);R=Math.min(R,z),D=Math.max(D,z)}let x=Math.min(T,D)-Math.max(F,R);if(x<0)return null;if(x<Math.abs(a)){let d=D-F,z=R-T;a=Math.abs(d)<Math.abs(z)?d:z,o=O.scale(a)}}return o}l(zn,"sat");var gt=2.5949095,Yn=1.70158+1,Xn=2*Math.PI/3,Kn=2*Math.PI/4.5,wt={linear:i=>i,easeInSine:i=>1-Math.cos(i*Math.PI/2),easeOutSine:i=>Math.sin(i*Math.PI/2),easeInOutSine:i=>-(Math.cos(Math.PI*i)-1)/2,easeInQuad:i=>i*i,easeOutQuad:i=>1-(1-i)*(1-i),easeInOutQuad:i=>i<.5?2*i*i:1-Math.pow(-2*i+2,2)/2,easeInCubic:i=>i*i*i,easeOutCubic:i=>1-Math.pow(1-i,3),easeInOutCubic:i=>i<.5?4*i*i*i:1-Math.pow(-2*i+2,3)/2,easeInQuart:i=>i*i*i*i,easeOutQuart:i=>1-Math.pow(1-i,4),easeInOutQuart:i=>i<.5?8*i*i*i*i:1-Math.pow(-2*i+2,4)/2,easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>1-Math.pow(1-i,5),easeInOutQuint:i=>i<.5?16*i*i*i*i*i:1-Math.pow(-2*i+2,5)/2,easeInExpo:i=>i===0?0:Math.pow(2,10*i-10),easeOutExpo:i=>i===1?1:1-Math.pow(2,-10*i),easeInOutExpo:i=>i===0?0:i===1?1:i<.5?Math.pow(2,20*i-10)/2:(2-Math.pow(2,-20*i+10))/2,easeInCirc:i=>1-Math.sqrt(1-Math.pow(i,2)),easeOutCirc:i=>Math.sqrt(1-Math.pow(i-1,2)),easeInOutCirc:i=>i<.5?(1-Math.sqrt(1-Math.pow(2*i,2)))/2:(Math.sqrt(1-Math.pow(-2*i+2,2))+1)/2,easeInBack:i=>Yn*i*i*i-1.70158*i*i,easeOutBack:i=>1+Yn*Math.pow(i-1,3)+1.70158*Math.pow(i-1,2),easeInOutBack:i=>i<.5?Math.pow(2*i,2)*((gt+1)*2*i-gt)/2:(Math.pow(2*i-2,2)*((gt+1)*(i*2-2)+gt)+2)/2,easeInElastic:i=>i===0?0:i===1?1:-Math.pow(2,10*i-10)*Math.sin((i*10-10.75)*Xn),easeOutElastic:i=>i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i*10-.75)*Xn)+1,easeInOutElastic:i=>i===0?0:i===1?1:i<.5?-(Math.pow(2,20*i-10)*Math.sin((20*i-11.125)*Kn))/2:Math.pow(2,-20*i+10)*Math.sin((20*i-11.125)*Kn)/2+1,easeInBounce:i=>1-wt.easeOutBounce(1-i),easeOutBounce:i=>i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375,easeInOutBounce:i=>i<.5?(1-wt.easeOutBounce(1-2*i))/2:(1+wt.easeOutBounce(2*i-1))/2},et=wt;var Ee=class extends Map{lastID;constructor(...n){super(...n),this.lastID=0}push(n){let a=this.lastID;return this.set(a,n),this.lastID++,a}pushd(n){let a=this.push(n);return()=>this.delete(a)}};l(Ee,"IDList");var Z=class{handlers=new Ee;add(n){let o={paused:!1,cancel:this.handlers.pushd((...b)=>{o.paused||n(...b)})};return o}addOnce(n){let a=this.add((...o)=>{a.cancel(),n(...o)});return a}next(){return new Promise(n=>this.addOnce(n))}trigger(...n){this.handlers.forEach(a=>a(...n))}numListeners(){return this.handlers.size}};l(Z,"Event");var he=class{handlers=new Map;on(n,a){return this.handlers.get(n)||this.handlers.set(n,new Z),this.handlers.get(n).add(a)}onOnce(n,a){let o=this.on(n,(...b)=>{o.cancel(),a(...b)});return o}next(n){return new Promise(a=>{this.onOnce(n,a)})}trigger(n,...a){this.handlers.get(n)&&this.handlers.get(n).trigger(...a)}remove(n){this.handlers.delete(n)}clear(){this.handlers=new Map}numListeners(n){return this.handlers.get(n)?.numListeners()??0}};l(he,"EventHandler");function Nt(i,n){let a=typeof i,o=typeof n;if(a!==o)return!1;if(a==="object"&&o==="object"&&i!==null&&n!==null){let b=Object.keys(i),E=Object.keys(n);if(b.length!==E.length)return!1;for(let B of b){let g=i[B],O=n[B];if(!(typeof g=="function"&&typeof O=="function")&&!Nt(g,O))return!1}return!0}return i===n}l(Nt,"deepEq");function Vs(i){let n=window.atob(i),a=n.length,o=new Uint8Array(a);for(let b=0;b<a;b++)o[b]=n.charCodeAt(b);return o.buffer}l(Vs,"base64ToArrayBuffer");function Wn(i){return Vs(i.split(",")[1])}l(Wn,"dataURLToArrayBuffer");function bt(i,n){let a=document.createElement("a");a.href=n,a.download=i,a.click()}l(bt,"download");function Ht(i,n){bt(i,"data:text/plain;charset=utf-8,"+n)}l(Ht,"downloadText");function Jn(i,n){Ht(i,JSON.stringify(n))}l(Jn,"downloadJSON");function qt(i,n){let a=URL.createObjectURL(n);bt(i,a),URL.revokeObjectURL(a)}l(qt,"downloadBlob");function $t(i){return i.match(/^data:\w+\/\w+;base64,.+/)}l($t,"isDataURL");var Qn=(()=>{let i=0;return()=>i++})();var je=class{dts=[];timer=0;fps=0;tick(n){this.dts.push(n),this.timer+=n,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((a,o)=>a+o)/this.dts.length)),this.dts=[])}};l(je,"FPSCounter");var pe=class{time;action;finished=!1;paused=!1;constructor(n,a){this.time=n,this.action=a}tick(n){return this.finished||this.paused?!1:(this.time-=n,this.time<=0?(this.action(),this.finished=!0,this.time=0,!0):!1)}reset(n){this.time=n,this.finished=!1}};l(pe,"Timer");var Zn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==";var ks={};Bn(ks,{default:()=>zt});var zt=Bs("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV");var er="data:image/png;base64,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";var tr="data:image/png;base64,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";var qs="3000.0.0-alpha.23",nr={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"},$s=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),rr=["left","middle","right","back","forward"],ir=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",sr=0,or=3,zs=0,Ys=3,Xs=-1200,Ks=1200,vt="topleft",ar=64,Ws="monospace",yt="monospace",Js=36,ur=64,cr=256,hr=2048,lr=2048,dr=2048,fr=2048,mr=.1,Qs=1,wr=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Ut=wr.reduce((i,n)=>i+n.size,0),br=2048,pr=br*4*Ut,gr=br*6,Zs=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,eo=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,Yt=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Xt=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,to=new Set(["id","require"]),no=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function ro(i){i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen()}l(ro,"enterFullscreen");function io(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}l(io,"exitFullscreen");function so(){return document.fullscreenElement||document.webkitFullscreenElement}l(so,"getFullscreenElement");function ke(i){switch(i){case"topleft":return new w(-1,-1);case"top":return new w(0,-1);case"topright":return new w(1,-1);case"left":return new w(-1,0);case"center":return new w(0,0);case"right":return new w(1,0);case"botleft":return new w(-1,1);case"bot":return new w(0,1);case"botright":return new w(1,1);default:return i}}l(ke,"anchorPt");function oo(i){switch(i){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}l(oo,"alignPt");function Kt(i){return i.createBuffer(1,1,44100)}l(Kt,"createEmptyAudioBuffer");var _e=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(n){this.pressed.add(n),this.pressedRepeat.add(n),this.down.add(n)}pressRepeat(n){this.pressedRepeat.add(n)}release(n){this.down.delete(n),this.pressed.delete(n),this.released.add(n)}};l(_e,"ButtonState");var ao=l((i={})=>{let n=[],a=(()=>{let e=i.root??document.body;e===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let t=i.canvas??(()=>{let M=document.createElement("canvas");return e.appendChild(M),M})(),r=i.scale??1,u=!(i.width&&i.height&&!i.stretch&&!i.letterbox),h=t.parentElement.offsetWidth,s=t.parentElement.offsetHeight;u?(t.width=h,t.height=s):(t.width=i.width*r,t.height=i.height*r);let c=t.width,f=t.height,m=i.pixelDensity||window.devicePixelRatio;t.width*=m,t.height*=m;let p=[`width: ${c}px`,`height: ${f}px`,"outline: none","cursor: default"];i.crisp&&(p.push("image-rendering: pixelated"),p.push("image-rendering: crisp-edges")),t.style.cssText=p.join(";"),t.tabIndex=0;let y=document.createElement("canvas");y.width=cr,y.height=cr;let U=y.getContext("2d",{willReadFrequently:!0});return{canvas:t,pixelDensity:m,fontCacheCanvas:y,fontCacheCtx:U,stretchToParent:u,lastParentWidth:h,lastParentHeight:s,keyState:new _e,mouseState:new _e,virtualButtonState:new _e,charInputted:[],isMouseMoved:!1,mouseStarted:!1,mousePos:new w(0,0),mouseDeltaPos:new w(0,0),time:0,realTime:0,skipTime:!1,dt:0,numFrames:0,isTouchScreen:"ontouchstart"in window||navigator.maxTouchPoints>0,loopID:null,stopped:!1,paused:!1,fpsCounter:new je}})(),o=a.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});class b{src=null;glTex;width;height;constructor(t,r,u={}){this.glTex=o.createTexture(),n.push(()=>this.free()),this.bind(),t&&r&&o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t,r,0,o.RGBA,o.UNSIGNED_BYTE,null),this.width=t,this.height=r;let h=(()=>{switch(u.filter??i.texFilter){case"linear":return o.LINEAR;case"nearest":return o.NEAREST;default:return o.NEAREST}})(),s=(()=>{switch(u.wrap){case"repeat":return o.REPEAT;case"clampToEdge":return o.CLAMP_TO_EDGE;default:return o.CLAMP_TO_EDGE}})();o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,h),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,h),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,s),this.unbind()}static fromImage(t,r={}){let u=new b(0,0,r);return u.bind(),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t),u.width=t.width,u.height=t.height,u.unbind(),u.src=t,u}update(t,r=0,u=0){this.bind(),o.texSubImage2D(o.TEXTURE_2D,0,r,u,o.RGBA,o.UNSIGNED_BYTE,t),this.unbind()}bind(){o.bindTexture(o.TEXTURE_2D,this.glTex)}unbind(){o.bindTexture(o.TEXTURE_2D,null)}free(){o.deleteTexture(this.glTex)}}l(b,"Texture");class E{tex;canvas;ctx;x=0;y=0;curHeight=0;constructor(t,r){this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=r,this.tex=b.fromImage(this.canvas),this.ctx=this.canvas.getContext("2d")}add(t){if(t.width>this.canvas.width||t.height>this.canvas.height)throw new Error(`Texture size (${t.width} x ${t.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+t.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+t.height>this.canvas.height&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tex=b.fromImage(this.canvas),this.x=0,this.y=0,this.curHeight=0);let r=new w(this.x,this.y);return this.x+=t.width,t.height>this.curHeight&&(this.curHeight=t.height),t instanceof ImageData?this.ctx.putImageData(t,r.x,r.y):this.ctx.drawImage(t,r.x,r.y),this.tex.update(this.canvas),[this.tex,new G(r.x/this.canvas.width,r.y/this.canvas.height,t.width/this.canvas.width,t.height/this.canvas.height)]}}l(E,"TexPacker");class B{tex;glFrameBuffer;glRenderBuffer;constructor(t,r,u={}){this.tex=new b(t,r,u),this.glFrameBuffer=o.createFramebuffer(),this.glRenderBuffer=o.createRenderbuffer(),n.push(()=>this.free()),this.bind(),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,t,r),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,this.tex.glTex,0),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,this.glRenderBuffer),this.unbind()}bind(){o.bindFramebuffer(o.FRAMEBUFFER,this.glFrameBuffer),o.bindRenderbuffer(o.RENDERBUFFER,this.glRenderBuffer)}unbind(){o.bindFramebuffer(o.FRAMEBUFFER,null),o.bindRenderbuffer(o.RENDERBUFFER,null)}free(){o.deleteFramebuffer(this.glFrameBuffer),o.deleteRenderbuffer(this.glRenderBuffer)}}l(B,"FrameBuffer");let g=(()=>{let e=xt(Yt,Xt),t=b.fromImage(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),r=new B(o.drawingBufferWidth,o.drawingBufferHeight);if(i.background){let c=C.fromArray(i.background);o.clearColor(c.r/255,c.g/255,c.b/255,(i.background[3]??255)/255)}o.enable(o.BLEND),o.enable(o.SCISSOR_TEST),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA);let u=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,u),o.bufferData(o.ARRAY_BUFFER,pr*4,o.DYNAMIC_DRAW),wr.reduce((c,f,m)=>(o.vertexAttribPointer(m,f.size,o.FLOAT,!1,Ut*4,c),o.enableVertexAttribArray(m),c+f.size*4),0),o.bindBuffer(o.ARRAY_BUFFER,null);let h=o.createBuffer();o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,h),o.bufferData(o.ELEMENT_ARRAY_BUFFER,gr*4,o.DYNAMIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null);let s=b.fromImage(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{drawCalls:0,lastDrawCalls:0,defShader:e,curShader:e,frameBuffer:r,postShader:null,postShaderUniform:null,defTex:t,curTex:t,curUniform:{},vbuf:u,ibuf:h,vqueue:[],iqueue:[],transform:new I,transformStack:[],bgTex:s,width:i.width,height:i.height,viewport:{x:0,y:0,width:o.drawingBufferWidth,height:o.drawingBufferHeight}}})();class O{tex;frames=[new G(0,0,1,1)];anims={};constructor(t,r,u={}){this.tex=t,r&&(this.frames=r),this.anims=u}static from(t,r={}){return typeof t=="string"?O.fromURL(t,r):Promise.resolve(O.fromImage(t,r))}static fromImage(t,r={}){let[u,h]=x.packer.add(t),s=r.frames?r.frames.map(c=>new G(h.x+c.x*h.w,h.y+c.y*h.h,c.w*h.w,c.h*h.h)):Wt(r.sliceX||1,r.sliceY||1,h.x,h.y,h.w,h.h);return new O(u,s,r.anims??{})}static fromURL(t,r={}){return fe(t).then(u=>O.fromImage(u,r))}}l(O,"SpriteData");class F{buf;constructor(t){this.buf=t}static fromArrayBuffer(t){return new Promise((r,u)=>T.ctx.decodeAudioData(t,r,u)).then(r=>new F(r))}static fromURL(t){return $t(t)?F.fromArrayBuffer(Wn(t)):Et(t).then(r=>F.fromArrayBuffer(r))}}l(F,"SoundData");let T=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let r=new F(Kt(e));return e.decodeAudioData(zt.buffer.slice(0)).then(u=>{r.buf=u}).catch(u=>{console.error("Failed to load burp: ",u)}),{ctx:e,masterNode:t,burpSnd:r}})();class R{done=!1;data=null;error=null;onLoadEvents=new Z;onErrorEvents=new Z;onFinishEvents=new Z;constructor(t){t.then(r=>{this.data=r,this.onLoadEvents.trigger(r)}).catch(r=>{if(this.error=r,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(r);else throw r}).finally(()=>{this.onFinishEvents.trigger(),this.done=!0})}static loaded(t){let r=new R(Promise.resolve(t));return r.data=t,r.done=!0,r}onLoad(t){return this.onLoadEvents.add(t),this}onError(t){return this.onErrorEvents.add(t),this}onFinish(t){return this.onFinishEvents.add(t),this}then(t){return this.onLoad(t)}catch(t){return this.onError(t)}finally(t){return this.onFinish(t)}}l(R,"Asset");class D{assets=new Map;lastUID=0;add(t,r){let u=t??this.lastUID+++"",h=new R(r);return this.assets.set(u,h),h}addLoaded(t,r){let u=t??this.lastUID+++"",h=R.loaded(r);return this.assets.set(u,h),h}get(t){return this.assets.get(t)}progress(){if(this.assets.size===0)return 1;let t=0;return this.assets.forEach(r=>{r.done&&t++}),t/this.assets.size}}l(D,"AssetBucket");let x={urlPrefix:"",sprites:new D,fonts:new D,bitmapFonts:new D,sounds:new D,shaders:new D,custom:new D,packer:new E(dr,fr),loaded:!1},d={ev:new he,objEvents:new he,root:bn([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new w(1),angle:0,shake:0,transform:new I}};function z(e){return x.custom.add(null,e)}l(z,"load");function oe(){let e=[x.sprites,x.sounds,x.shaders,x.fonts,x.bitmapFonts,x.custom];return e.reduce((t,r)=>t+r.progress(),0)/e.length}l(oe,"loadProgress");function tt(e){return e!==void 0&&(x.urlPrefix=e),x.urlPrefix}l(tt,"loadRoot");function xe(e){let t=x.urlPrefix+e;return fetch(t).then(r=>{if(!r.ok)throw new Error(`Failed to fetch ${t}`);return r})}l(xe,"fetchURL");function Se(e){return xe(e).then(t=>t.json())}l(Se,"fetchJSON");function nt(e){return xe(e).then(t=>t.text())}l(nt,"fetchText");function Et(e){return xe(e).then(t=>t.arrayBuffer())}l(Et,"fetchArrayBuffer");function fe(e){let t=new Image;return t.crossOrigin="anonymous",t.src=$t(e)?e:x.urlPrefix+e,new Promise((r,u)=>{t.onload=()=>r(t),t.onerror=()=>u(new Error(`Failed to load image from "${e}"`))})}l(fe,"loadImg");function Ne(e,t,r={}){let u=new FontFace(e,typeof t=="string"?`url(${t})`:t);return document.fonts.add(u),x.fonts.add(e,u.load().catch(h=>{throw new Error(`Failed to load font from "${t}": ${h}`)}))}l(Ne,"loadFont");function vr(e,t,r,u,h={}){return x.bitmapFonts.add(e,fe(t).then(s=>Pr(b.fromImage(s,h),r,u,h.chars??ir)))}l(vr,"loadBitmapFont");function Wt(e=1,t=1,r=0,u=0,h=1,s=1){let c=[],f=h/e,m=s/t;for(let p=0;p<t;p++)for(let y=0;y<e;y++)c.push(new G(r+y*f,u+p*m,f,m));return c}l(Wt,"slice");function Jt(e,t){return z(typeof t=="string"?new Promise((r,u)=>{Se(t).then(h=>{Jt(e,h).then(r).catch(u)})}):O.from(e).then(r=>{let u={};for(let h in t){let s=t[h],c=r.frames[0],f=dr*c.w,m=fr*c.h,p=s.frames?s.frames.map(U=>new G(c.x+(s.x+U.x)/f*c.w,c.y+(s.y+U.y)/m*c.h,U.w/f*c.w,U.h/m*c.h)):Wt(s.sliceX||1,s.sliceY||1,c.x+s.x/f*c.w,c.y+s.y/m*c.h,s.width/f*c.w,s.height/m*c.h),y=new O(r.tex,p,s.anims);x.sprites.addLoaded(h,y),u[h]=y}return u}))}l(Jt,"loadSpriteAtlas");function Qt(e,t={}){let r=document.createElement("canvas"),u=e[0].width,h=e[0].height;r.width=u*e.length,r.height=h;let s=r.getContext("2d");e.forEach((f,m)=>{f instanceof ImageData?s.putImageData(f,m*u,0):s.drawImage(f,m*u,0)});let c=s.getImageData(0,0,e.length*u,h);return O.fromImage(c,{...t,sliceX:e.length,sliceY:1})}l(Qt,"createSpriteSheet");function Ce(e,t,r={sliceX:1,sliceY:1,anims:{}}){return Array.isArray(t)?t.some(u=>typeof u=="string")?x.sprites.add(e,Promise.all(t.map(u=>typeof u=="string"?fe(u):Promise.resolve(u))).then(u=>Qt(u,r))):x.sprites.addLoaded(e,Qt(t,r)):typeof t=="string"?x.sprites.add(e,O.from(t,r)):x.sprites.addLoaded(e,O.fromImage(t,r))}l(Ce,"loadSprite");function yr(e,t){return x.sprites.add(e,new Promise(async r=>{let u=typeof t=="string"?await Se(t):t,h=await Promise.all(u.frames.map(fe)),s=document.createElement("canvas");s.width=u.width,s.height=u.height*u.frames.length;let c=s.getContext("2d");h.forEach((m,p)=>{c.drawImage(m,0,p*u.height)});let f=await Ce(null,s,{sliceY:u.frames.length,anims:u.anims});r(f)}))}l(yr,"loadPedit");function Ur(e,t,r){return x.sprites.add(e,new Promise(async u=>{let h=await Ce(null,t),s=typeof r=="string"?await Se(r):r,c=s.meta.size;h.frames=s.frames.map(f=>new G(f.frame.x/c.w,f.frame.y/c.h,f.frame.w/c.w,f.frame.h/c.h));for(let f of s.meta.frameTags)f.from===f.to?h.anims[f.name]=f.from:h.anims[f.name]={from:f.from,to:f.to,speed:10,loop:!0,pingpong:f.direction==="pingpong"};u(h)}))}l(Ur,"loadAseprite");function Er(e,t,r){return x.shaders.addLoaded(e,xt(t,r))}l(Er,"loadShader");function xr(e,t,r){return x.shaders.add(e,new Promise(u=>{let h=l(s=>s?nt(s):new Promise(c=>c(null)),"resolveUrl");return Promise.all([h(t),h(r)]).then(([s,c])=>{u(xt(s,c))})}))}l(xr,"loadShaderURL");function Sr(e,t){return x.sounds.add(e,typeof t=="string"?F.fromURL(t):F.fromArrayBuffer(t))}l(Sr,"loadSound");function Cr(e="bean"){return Ce(e,Zn)}l(Cr,"loadBean");function Zt(e){return x.sprites.get(e)}l(Zt,"getSprite");function en(e){return x.sounds.get(e)}l(en,"getSound");function Tr(e){return x.fonts.get(e)}l(Tr,"getFont");function tn(e){return x.bitmapFonts.get(e)}l(tn,"getBitmapFont");function nn(e){return x.shaders.get(e)}l(nn,"getShader");function rn(e){if(typeof e=="string"){let t=Zt(e);if(t)return t;if(oe()<1)return null;throw new Error(`Sprite not found: ${e}`)}else{if(e instanceof O)return R.loaded(e);if(e instanceof R)return e;throw new Error(`Invalid sprite: ${e}`)}}l(rn,"resolveSprite");function Ar(e){if(typeof e=="string"){let t=en(e);if(t)return t.data?t.data:t;if(oe()<1)return null;throw new Error(`Sound not found: ${e}`)}else{if(e instanceof F)return e;if(e instanceof R)return e.data?e.data:e;throw new Error(`Invalid sound: ${e}`)}}l(Ar,"resolveSound");function Or(e){if(!e)return g.defShader;if(typeof e=="string"){let t=nn(e);if(t)return t.data?t.data:t;if(oe()<1)return null;throw new Error(`Shader not found: ${e}`)}else if(e instanceof R)return e.data?e.data:e;return e}l(Or,"resolveShader");function sn(e){if(!e)return sn(i.font??Ws);if(typeof e=="string"){let t=tn(e);if(t)return t.data?t.data:t;if(document.fonts.check(`${ur}px ${e}`))return e;if(oe()<1)return null;throw new Error(`Font not found: ${e}`)}else if(e instanceof R)return e.data?e.data:e;return e}l(sn,"resolveFont");function Rr(e){return e!==void 0&&(T.masterNode.gain.value=re(e,sr,or)),T.masterNode.gain.value}l(Rr,"volume");function He(e,t={loop:!1,volume:1,speed:1,detune:0,seek:0}){let r=Ar(e);if(r instanceof R){let U=He(new F(Kt(T.ctx))),M=l(P=>{let H=He(P,t);for(let $ in H)U[$]=H[$]},"doPlay");return r.onLoad(M),U}else if(r===null){let U=He(new F(Kt(T.ctx)));return Lt(()=>{}),U}let u=T.ctx,h=!1,s=u.createBufferSource();s.buffer=r.buf,s.loop=!!t.loop;let c=u.createGain();s.connect(c),c.connect(T.masterNode);let f=t.seek??0;s.start(0,f);let m=u.currentTime-f,p=null,y={stop(){h||(this.pause(),m=u.currentTime)},play(U){if(!h)return;let M=s;s=u.createBufferSource(),s.buffer=M.buffer,s.loop=M.loop,s.playbackRate.value=M.playbackRate.value,s.detune&&(s.detune.value=M.detune.value),s.connect(c);let P=U??this.time();s.start(0,P),m=u.currentTime-P,h=!1,p=null},pause(){h||(s.stop(),h=!0,p=u.currentTime)},isPaused(){return h},isStopped(){return h},speed(U){return U!==void 0&&(s.playbackRate.value=re(U,zs,Ys)),s.playbackRate.value},detune(U){return s.detune?(U!==void 0&&(s.detune.value=re(U,Xs,Ks)),s.detune.value):0},volume(U){return U!==void 0&&(c.gain.value=re(U,sr,or)),c.gain.value},loop(){s.loop=!0},unloop(){s.loop=!1},duration(){return r.buf.duration},time(){return h?p-m:u.currentTime-m}};return y.speed(t.speed),y.detune(t.detune),y.volume(t.volume),y}l(He,"play");function on(e){return He(T.burpSnd,e)}l(on,"burp");function xt(e=Yt,t=Xt){let r=Zs.replace("{{user}}",e??Yt),u=eo.replace("{{user}}",t??Xt),h=o.createShader(o.VERTEX_SHADER),s=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(h,r),o.shaderSource(s,u),o.compileShader(h),o.compileShader(s);let c=o.createProgram();if(n.push(()=>o.deleteProgram(c)),o.attachShader(c,h),o.attachShader(c,s),o.bindAttribLocation(c,0,"a_pos"),o.bindAttribLocation(c,1,"a_uv"),o.bindAttribLocation(c,2,"a_color"),o.linkProgram(c),!o.getProgramParameter(c,o.LINK_STATUS)){let f=l(U=>{let M=/^ERROR:\s0:(?<line>\d+):\s(?<msg>.+)/,P=U.match(M);return{line:Number(P.groups.line),msg:P.groups.msg.replace(/\n\0$/,"")}},"formatShaderError"),m=o.getShaderInfoLog(h),p=o.getShaderInfoLog(s),y="";if(m){let U=f(m);y+=`Vertex shader line ${U.line-14}: ${U.msg}`}if(p){let U=f(p);y+=`Fragment shader line ${U.line-14}: ${U.msg}`}throw new Error(y)}return o.deleteShader(h),o.deleteShader(s),{bind(){o.useProgram(c)},unbind(){o.useProgram(null)},free(){o.deleteProgram(c)},send(f){for(let m in f){let p=f[m],y=o.getUniformLocation(c,m);typeof p=="number"?o.uniform1f(y,p):p instanceof I?o.uniformMatrix4fv(y,!1,new Float32Array(p.m)):p instanceof C?o.uniform3f(y,p.r,p.g,p.b):p instanceof w&&o.uniform2f(y,p.x,p.y)}}}}l(xt,"makeShader");function Pr(e,t,r,u){let h=e.width/t,s={},c=u.split("").entries();for(let[f,m]of c)s[m]=new G(f%h*t,Math.floor(f/h)*r,t,r);return{tex:e,map:s,size:r}}l(Pr,"makeFont");function St(e,t,r,u=g.defTex,h=g.defShader,s={}){let c=Or(h);if(!c||c instanceof R)return;(u!==g.curTex||c!==g.curShader||!Nt(g.curUniform,s)||g.vqueue.length+e.length*Ut>pr||g.iqueue.length+t.length>gr)&&le();let f=r?g.transform:d.cam.transform.mult(g.transform);for(let m of e){let p=Br(f.multVec2(m.pos));g.vqueue.push(p.x,p.y,m.uv.x,m.uv.y,m.color.r/255,m.color.g/255,m.color.b/255,m.opacity)}for(let m of t)g.iqueue.push(m+g.vqueue.length/Ut-e.length);g.curTex=u,g.curShader=c,g.curUniform=s}l(St,"drawRaw");function le(){!g.curTex||!g.curShader||g.vqueue.length===0||g.iqueue.length===0||(o.bindBuffer(o.ARRAY_BUFFER,g.vbuf),o.bufferSubData(o.ARRAY_BUFFER,0,new Float32Array(g.vqueue)),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,g.ibuf),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(g.iqueue)),g.curShader.bind(),g.curShader.send(g.curUniform),g.curTex.bind(),o.drawElements(o.TRIANGLES,g.iqueue.length,o.UNSIGNED_SHORT,0),g.curTex.unbind(),g.curShader.unbind(),o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),g.vqueue.length=0,g.iqueue.length=0,g.drawCalls++)}l(le,"flush");function Dr(){o.clear(o.COLOR_BUFFER_BIT),g.frameBuffer.bind(),o.clear(o.COLOR_BUFFER_BIT),kr(),i.background||ae(()=>{Oe({width:N(),height:j(),quad:new G(0,0,N()/ar,j()/ar),tex:g.bgTex,fixed:!0})}),g.drawCalls=0,g.transformStack.length=0,g.transform=new I}l(Dr,"frameStart");function Mr(e,t){g.postShader=e,g.postShaderUniform=t??null}l(Mr,"usePostEffect");function Fr(){le(),g.frameBuffer.unbind(),ae(()=>{Ct({flipY:!0,tex:g.frameBuffer.tex,scale:new w(1/a.pixelDensity),shader:g.postShader,uniform:g.postShaderUniform,fixed:!0})}),le(),g.lastDrawCalls=g.drawCalls}l(Fr,"frameEnd");function Br(e){return new w(e.x/N()*2-1,-e.y/j()*2+1)}l(Br,"screen2ndc");function Lr(e){g.transform=e.clone()}l(Lr,"pushMatrix");function k(...e){if(e[0]===void 0)return;let t=v(...e);t.x===0&&t.y===0||g.transform.translate(t)}l(k,"pushTranslate");function Te(...e){if(e[0]===void 0)return;let t=v(...e);t.x===1&&t.y===1||g.transform.scale(t)}l(Te,"pushScale");function Ae(e){!e||g.transform.rotate(e)}l(Ae,"pushRotate");function ee(){g.transformStack.push(g.transform.clone())}l(ee,"pushTransform");function K(){g.transformStack.length>0&&(g.transform=g.transformStack.pop())}l(K,"popTransform");function Oe(e){if(e.width===void 0||e.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,r=e.height,h=ke(e.anchor||vt).scale(new w(t,r).scale(-.5)),s=e.quad||new G(0,0,1,1),c=e.color||S(255,255,255),f=e.opacity??1,m=e.tex?mr/e.tex.width:0,p=e.tex?mr/e.tex.height:0,y=s.x+m,U=s.y+p,M=s.w-m*2,P=s.h-p*2;ee(),k(e.pos),Ae(e.angle),Te(e.scale),k(h),St([{pos:new w(-t/2,r/2),uv:new w(e.flipX?y+M:y,e.flipY?U:U+P),color:c,opacity:f},{pos:new w(-t/2,-r/2),uv:new w(e.flipX?y+M:y,e.flipY?U+P:U),color:c,opacity:f},{pos:new w(t/2,-r/2),uv:new w(e.flipX?y:y+M,e.flipY?U+P:U),color:c,opacity:f},{pos:new w(t/2,r/2),uv:new w(e.flipX?y:y+M,e.flipY?U:U+P),color:c,opacity:f}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),K()}l(Oe,"drawUVQuad");function Ct(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let t=e.quad??new G(0,0,1,1),r=e.tex.width*t.w,u=e.tex.height*t.h,h=new w(1);if(e.tiled){let s=Math.ceil((e.width||r)/r),c=Math.ceil((e.height||u)/u),m=ke(e.anchor||vt).add(new w(1,1)).scale(.5).scale(s*r,c*u);for(let p=0;p<s;p++)for(let y=0;y<c;y++)Oe(Object.assign(e,{pos:(e.pos||new w(0)).add(new w(r*p,u*y)).sub(m),scale:h.scale(e.scale||new w(1)),tex:e.tex,quad:t,width:r,height:u,anchor:"topleft"}))}else e.width&&e.height?(h.x=e.width/r,h.y=e.height/u):e.width?(h.x=e.width/r,h.y=h.x):e.height&&(h.y=e.height/u,h.x=h.y),Oe(Object.assign(e,{scale:h.scale(e.scale||new w(1)),tex:e.tex,quad:t,width:r,height:u}))}l(Ct,"drawTexture");function Ir(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=rn(e.sprite);if(!t||!t.data)return;let r=t.data.frames[e.frame??0];if(!r)throw new Error(`Frame not found: ${e.frame??0}`);Ct(Object.assign(e,{tex:t.data.tex,quad:r.scale(e.quad||new G(0,0,1,1))}))}l(Ir,"drawSprite");function qe(e,t,r,u,h,s=1){u=ce(u%360),h=ce(h%360),h<=u&&(h+=Math.PI*2);let c=[],f=Math.ceil((h-u)/ce(8)*s),m=(h-u)/f;for(let p=u;p<h;p+=m)c.push(e.add(t*Math.cos(p),r*Math.sin(p)));return c.push(e.add(t*Math.cos(h),r*Math.sin(h))),c}l(qe,"getArcPts");function W(e){if(e.width===void 0||e.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,r=e.height,h=ke(e.anchor||vt).add(1,1).scale(new w(t,r).scale(-.5)),s=[new w(0,0),new w(t,0),new w(t,r),new w(0,r)];if(e.radius){let c=Math.min(Math.min(t,r)/2,e.radius);s=[new w(c,0),new w(t-c,0),...qe(new w(t-c,c),c,c,270,360),new w(t,c),new w(t,r-c),...qe(new w(t-c,r-c),c,c,0,90),new w(t-c,r),new w(c,r),...qe(new w(c,r-c),c,c,90,180),new w(0,r-c),new w(0,c),...qe(new w(c,c),c,c,180,270)]}we(Object.assign(e,{offset:h,pts:s,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}l(W,"drawRect");function $e(e){let{p1:t,p2:r}=e;if(!t||!r)throw new Error('drawLine() requires properties "p1" and "p2".');let u=e.width||1,h=r.sub(t).unit().normal().scale(u*.5),s=[t.sub(h),t.add(h),r.add(h),r.sub(h)].map(c=>({pos:new w(c.x,c.y),uv:new w(0),color:e.color??C.WHITE,opacity:e.opacity??1}));St(s,[0,1,3,1,2,3],e.fixed,g.defTex,e.shader,e.uniform)}l($e,"drawLine");function an(e){let t=e.pts;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2))if(e.radius&&t.length>=3){let r=t[0].sdist(t[1]);for(let h=1;h<t.length-1;h++)r=Math.min(t[h].sdist(t[h+1]),r);let u=Math.min(e.radius,Math.sqrt(r)/2);$e(Object.assign(e,{p1:t[0],p2:t[1]}));for(let h=1;h<t.length-2;h++){let s=t[h],c=t[h+1];$e(Object.assign(e,{p1:s,p2:c}))}$e(Object.assign(e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let r=0;r<t.length-1;r++)$e(Object.assign(e,{p1:t[r],p2:t[r+1]})),e.join!=="none"&&ge(Object.assign(e,{pos:t[r],radius:e.width/2}))}l(an,"drawLines");function un(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawPolygon() requires properties "p1", "p2" and "p3".');return we(Object.assign(e,{pts:[e.p1,e.p2,e.p3]}))}l(un,"drawTriangle");function ge(e){if(!e.radius)throw new Error('drawCircle() requires property "radius".');e.radius!==0&&cn(Object.assign(e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}l(ge,"drawCircle");function cn(e){if(e.radiusX===void 0||e.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(e.radiusX===0||e.radiusY===0)return;let t=e.start??0,r=e.end??360,u=ke(e.anchor??"center").scale(new w(-e.radiusX,-e.radiusY)),h=qe(u,e.radiusX,e.radiusY,t,r,e.resolution);h.unshift(u);let s=Object.assign(e,{pts:h,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(h.length-1).fill(e.gradient[1])]}:{}});if(r-t>=360&&e.outline){e.fill!==!1&&we(Object.assign(s,{outline:null})),we(Object.assign(s,{pts:h.slice(1),fill:!1}));return}we(s)}l(cn,"drawEllipse");function we(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(ee(),k(e.pos),Te(e.scale),Ae(e.angle),k(e.offset),e.fill!==!1){let r=e.color??C.WHITE,u=e.pts.map((s,c)=>({pos:new w(s.x,s.y),uv:new w(0,0),color:e.colors?e.colors[c]??r:r,opacity:e.opacity??1})),h=[...Array(t-2).keys()].map(s=>[0,s+1,s+2]).flat();St(u,e.indices??h,e.fixed,g.defTex,e.shader,e.uniform)}e.outline&&an({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),K()}}l(we,"drawPolygon");function hn(e,t,r){le(),o.clear(o.STENCIL_BUFFER_BIT),o.enable(o.STENCIL_TEST),o.stencilFunc(o.NEVER,1,255),o.stencilOp(o.REPLACE,o.REPLACE,o.REPLACE),t(),le(),o.stencilFunc(r,1,255),o.stencilOp(o.KEEP,o.KEEP,o.KEEP),e(),le(),o.disable(o.STENCIL_TEST)}l(hn,"drawStenciled");function Gr(e,t){hn(e,t,o.EQUAL)}l(Gr,"drawMasked");function Vr(e,t){hn(e,t,o.NOTEQUAL)}l(Vr,"drawSubtracted");function ln(){return(g.viewport.width+g.viewport.height)/(g.width+g.height)}l(ln,"getViewportScale");function ae(e){le();let t=g.width,r=g.height;g.width=g.viewport.width,g.height=g.viewport.height,e(),le(),g.width=t,g.height=r}l(ae,"drawUnscaled");function dn(e,t){t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(v(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&(e.color=e.color.mult(t.color)),t.opacity&&(e.opacity*=t.opacity)}l(dn,"applyCharTransform");let fn=/\[(?<text>[^\]]*)\]\.(?<style>[\w\.]+)+/g;function jr(e){let t={},r=e.replace(fn,"$1"),u=0;for(let h of e.matchAll(fn)){let s=h.groups.style.split("."),c=h.index-u;for(let f=c;f<h.index+h.groups.text.length;f++)t[f]={localIdx:f-c,styles:s};u+=3+h.groups.style.length}return{charStyleMap:t,text:r}}l(jr,"compileStyledText");let Tt={};function be(e){if(e.text===void 0)throw new Error('formatText() requires property "text".');let t=sn(e.font);if(e.text===""||t instanceof R||!t)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:r,text:u}=jr(e.text+""),h=u.split("");if(t instanceof FontFace||typeof t=="string"){let q=t instanceof FontFace?t.family:t,A=Tt[q]??{font:{tex:new b(hr,lr),map:{},size:ur},cursor:new w(0)};Tt[q]||(Tt[q]=A),t=A.font;for(let _ of h)if(!A.font.map[_]){let ie=a.fontCacheCtx;ie.font=`${t.size}px ${q}`,ie.clearRect(0,0,a.fontCacheCanvas.width,a.fontCacheCanvas.height),ie.textBaseline="top",ie.textAlign="left",ie.fillStyle="rgb(255, 255, 255)",ie.fillText(_,0,0);let Je=ie.measureText(_),Fe=Math.ceil(Je.width),Be=ie.getImageData(0,0,Fe,t.size);if(A.cursor.x+Fe>hr&&(A.cursor.x=0,A.cursor.y+=t.size,A.cursor.y>lr))throw new Error("Font atlas exceeds character limit");t.tex.update(Be,A.cursor.x,A.cursor.y),t.map[_]=new G(A.cursor.x,A.cursor.y,Fe,t.size),A.cursor.x+=Fe}}let s=e.size||t.size,c=v(e.scale??1).scale(s/t.size),f=e.lineSpacing??0,m=e.letterSpacing??0,p=0,y=0,U=0,M=[],P=[],H=0,$=null,ye=null;for(;H<h.length;){let q=h[H];if(q===`
`)U+=s+f,M.push({width:p-m,chars:P}),$=null,ye=null,p=0,P=[];else{let A=t.map[q];if(A){let _=A.w*c.x;e.width&&p+_>e.width&&(U+=s+f,$!=null&&(H-=P.length-$,q=h[H],A=t.map[q],_=A.w*c.x,P=P.slice(0,$-1),p=ye),$=null,ye=null,M.push({width:p-m,chars:P}),p=0,P=[]),P.push({tex:t.tex,width:A.w,height:A.h,quad:new G(A.x/t.tex.width,A.y/t.tex.height,A.w/t.tex.width,A.h/t.tex.height),ch:q,pos:new w(p,U),opacity:e.opacity??1,color:e.color??C.WHITE,scale:v(c),angle:0}),q===" "&&($=P.length,ye=p),p+=_,y=Math.max(y,p),p+=m}}H++}M.push({width:p-m,chars:P}),U+=s,e.width&&(y=e.width);let J=[];for(let q of M){let A=(y-q.width)*oo(e.align??"left");for(let _ of q.chars){let ie=t.map[_.ch],Je=J.length,Fe=new w(ie.w*c.x*.5,ie.h*c.y*.5);if(_.pos=_.pos.add(A,0).add(Fe),e.transform){let Be=typeof e.transform=="function"?e.transform(Je,_.ch):e.transform;Be&&dn(_,Be)}if(r[Je]){let{styles:Be,localIdx:Ts}=r[Je];for(let As of Be){let Vt=e.styles[As],Fn=typeof Vt=="function"?Vt(Ts,_.ch):Vt;Fn&&dn(_,Fn)}}J.push(_)}}return{width:y,height:U,chars:J,opt:e}}l(be,"formatText");function rt(e){ve(be(e))}l(rt,"drawText");function ve(e){ee(),k(e.opt.pos),Ae(e.opt.angle),k(ke(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach(t=>{Oe({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})}),K()}l(ve,"drawFormattedText");function kr(){if(a.stretchToParent&&!Pt()){let h=a.canvas.parentElement.offsetWidth,s=a.canvas.parentElement.offsetHeight;if(h!==a.lastParentWidth||s!==a.lastParentHeight){a.canvas.width=h*a.pixelDensity,a.canvas.height=s*a.pixelDensity,a.canvas.style.width=h+"px",a.canvas.style.height=s+"px";let c=N(),f=j();d.ev.onOnce("frameEnd",()=>{d.ev.trigger("resize",c,f,N(),j())})}a.lastParentWidth=h,a.lastParentHeight=s}let e=a.pixelDensity,t=o.drawingBufferWidth/e,r=o.drawingBufferHeight/e;if(Pt()){let h=window.innerWidth,s=window.innerHeight,c=h/s,f=t/r;if(c>f){let m=window.innerHeight*f;g.viewport={x:(h-m)/2,y:0,width:m,height:s}}else{let m=window.innerWidth/f;g.viewport={x:0,y:(s-m)/2,width:h,height:m}}return}if(i.letterbox){if(!i.width||!i.height)throw new Error("Letterboxing requires width and height defined.");let h=t/r,s=i.width/i.height;if(h>s){i.stretch||(g.width=r*s,g.height=r);let c=r*s,f=r,m=(t-c)/2;o.scissor(m*e,0,c*e,f*e),o.viewport(m*e,0,c*e,r*e),g.viewport={x:m,y:0,width:c,height:r}}else{i.stretch||(g.width=t,g.height=t/s);let c=t,f=t/s,m=(r-f)/2;o.scissor(0,m*e,c*e,f*e),o.viewport(0,m*e,t*e,f*e),g.viewport={x:0,y:m,width:t,height:f}}return}if(i.stretch){if(!i.width||!i.height)throw new Error("Stretching requires width and height defined.");o.viewport(0,0,t*e,r*e),g.viewport={x:0,y:0,width:t,height:r};return}let u=i.scale??1;g.width=t/u,g.height=r/u,o.viewport(0,0,t*e,r*e),g.viewport={x:0,y:0,width:t,height:r}}l(kr,"updateViewport");function N(){return g.width}l(N,"width");function j(){return g.height}l(j,"height");let Y={},ze={},Re={};function Ye(e){return new w((e.x-g.viewport.x)*N()/g.viewport.width,(e.y-g.viewport.y)*j()/g.viewport.height)}l(Ye,"windowToContent");function _r(e){return new w(e.x*g.viewport.width/g.width,e.y*g.viewport.height/g.height)}l(_r,"contentToView");function At(e,t){let r=Ye(new w(e,t));a.mouseStarted&&(a.mouseDeltaPos=r.sub(a.mousePos)),a.mousePos=r,a.mouseStarted=!0,a.isMouseMoved=!0}l(At,"setMousePos"),Y.mousemove=e=>{let[t,r]=[e.offsetX,e.offsetY];d.ev.onOnce("input",()=>{At(t,r),d.ev.trigger("mouseMove")})},Y.mousedown=e=>{d.ev.onOnce("input",()=>{let t=rr[e.button];t&&a.mouseState.press(t),d.ev.trigger("mousePress",t)})},Y.mouseup=e=>{d.ev.onOnce("input",()=>{let t=rr[e.button];t&&a.mouseState.release(t),d.ev.trigger("mouseRelease",t)})},Y.keydown=e=>{$s.has(e.key)&&e.preventDefault(),d.ev.onOnce("input",()=>{let t=nr[e.key]||e.key.toLowerCase();t.length===1?(d.ev.trigger("charInput",t),a.charInputted.push(t)):t==="space"&&(d.ev.trigger("charInput"," "),a.charInputted.push(" ")),e.repeat?(a.keyState.pressRepeat(t),d.ev.trigger("keyPressRepeat",t)):(a.keyState.press(t),d.ev.trigger("keyPressRepeat",t),d.ev.trigger("keyPress",t))})},Y.keyup=e=>{d.ev.onOnce("input",()=>{let t=nr[e.key]||e.key.toLowerCase();a.keyState.release(t),d.ev.trigger("keyRelease",t)})},Y.touchstart=e=>{e.preventDefault(),d.ev.onOnce("input",()=>{let t=[...e.changedTouches];t.forEach(r=>{d.ev.trigger("onTouchStart",Ye(new w(r.clientX,r.clientY)),r)}),i.touchToMouse!==!1&&(At(t[0].clientX,t[0].clientY),a.mouseState.press("left"),d.ev.trigger("mousePress","left"))})},Y.touchmove=e=>{e.preventDefault(),d.ev.onOnce("input",()=>{let t=[...e.changedTouches];t.forEach(r=>{d.ev.trigger("onTouchMove",Ye(new w(r.clientX,r.clientY)),r)}),i.touchToMouse!==!1&&(d.ev.trigger("mouseMove","left"),At(t[0].clientX,t[0].clientY))})},Y.touchend=e=>{d.ev.onOnce("input",()=>{[...e.changedTouches].forEach(r=>{d.ev.trigger("onTouchEnd",Ye(new w(r.clientX,r.clientY)),r)}),i.touchToMouse!==!1&&(a.mouseState.release("left"),d.ev.trigger("mouseRelease","left"))})},Y.touchcancel=e=>{d.ev.onOnce("input",()=>{[...e.changedTouches].forEach(r=>{d.ev.trigger("onTouchEnd",Ye(new w(r.clientX,r.clientY)),r)}),i.touchToMouse!==!1&&(a.mouseState.release("left"),d.ev.trigger("mouseRelease","left"))})},Y.wheel=e=>{e.preventDefault(),d.ev.onOnce("input",()=>{d.ev.trigger("scroll",new w(e.deltaX,e.deltaY))})},Y.contextmenu=e=>e.preventDefault(),ze.visibilitychange=()=>{switch(document.visibilityState){case"visible":a.skipTime=!0,L.paused||T.ctx.resume();break;case"hidden":i.backgroundAudio||T.ctx.suspend();break}},Re.error=e=>{e.error?It(e.error):It(new Error(e.message))},Re.unhandledrejection=e=>It(e.reason);for(let e in Y)a.canvas.addEventListener(e,Y[e]);for(let e in ze)document.addEventListener(e,ze[e]);for(let e in Re)window.addEventListener(e,Re[e]);function Pe(){return a.mousePos.clone()}l(Pe,"mousePos");function mn(){return a.mouseDeltaPos.clone()}l(mn,"mouseDeltaPos");function it(e="left"){return a.mouseState.pressed.has(e)}l(it,"isMousePressed");function Nr(e="left"){return a.mouseState.down.has(e)}l(Nr,"isMouseDown");function Ot(e="left"){return a.mouseState.released.has(e)}l(Ot,"isMouseReleased");function Hr(){return a.isMouseMoved}l(Hr,"isMouseMoved");function qr(e){return e===void 0?a.keyState.pressed.size>0:a.keyState.pressed.has(e)}l(qr,"isKeyPressed");function $r(e){return e===void 0?a.keyState.pressedRepeat.size>0:a.keyState.pressedRepeat.has(e)}l($r,"isKeyPressedRepeat");function zr(e){return e===void 0?a.keyState.down.size>0:a.keyState.down.has(e)}l(zr,"isKeyDown");function Yr(e){return e===void 0?a.keyState.released.size>0:a.keyState.released.has(e)}l(Yr,"isKeyReleased");function Xr(e){return a.virtualButtonState.pressed.has(e)}l(Xr,"isVirtualButtonPressed");function Kr(e){return a.virtualButtonState.down.has(e)}l(Kr,"isVirtualButtonDown");function Wr(e){return a.virtualButtonState.released.has(e)}l(Wr,"isVirtualButtonReleased");function Jr(){return[...a.charInputted]}l(Jr,"charInputted");function Rt(){return a.time}l(Rt,"time");function Qr(){return a.canvas.toDataURL()}l(Qr,"screenshot");function pn(e){return e&&(a.canvas.style.cursor=e),a.canvas.style.cursor}l(pn,"setCursor");function Zr(e=!0){e?ro(a.canvas):io()}l(Zr,"setFullscreen");function Pt(){return Boolean(so())}l(Pt,"isFullscreen");function gn(){return a.isTouchScreen}l(gn,"isTouchScreen");let L={inspect:!1,timeScale:1,showLog:!0,fps:()=>a.fpsCounter.fps,numFrames:()=>a.numFrames,stepFrame:Pn,drawCalls:()=>g.drawCalls,clearLog:()=>d.logs=[],log:e=>{let t=i.logMax??Qs;d.logs.unshift(`${`[${Rt().toFixed(2)}].time `}[${e?.toString?e.toString():e}].${e instanceof Error?"error":"info"}`),d.logs.length>t&&(d.logs=d.logs.slice(0,t))},error:e=>L.log(new Error(e.toString?e.toString():e)),curRecording:null,get paused(){return a.paused},set paused(e){a.paused=e,e?T.ctx.suspend():T.ctx.resume()}};function te(){return a.dt*L.timeScale}l(te,"dt");function ei(...e){return e.length>0&&(d.cam.pos=v(...e)),d.cam.pos?d.cam.pos.clone():lt()}l(ei,"camPos");function ti(...e){return e.length>0&&(d.cam.scale=v(...e)),d.cam.scale.clone()}l(ti,"camScale");function ni(e){return e!==void 0&&(d.cam.angle=e),d.cam.angle}l(ni,"camRot");function ri(e=12){d.cam.shake=e}l(ri,"shake");function Dt(e){return d.cam.transform.multVec2(e)}l(Dt,"toScreen");function wn(e){return d.cam.transform.invert().multVec2(e)}l(wn,"toWorld");function st(e){let t=new I;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}l(st,"calcTransform");function bn(e){let t=new Map,r={},u=new he,h={id:Qn(),hidden:!1,paused:!1,transform:new I,children:[],parent:null,add(s){let c=(()=>{if(Array.isArray(s))return bn(s);if(s.parent)throw new Error("Cannot add a game obj that already has a parent.");return s})();return c.parent=this,c.transform=st(c),this.children.push(c),c.trigger("add",this),d.ev.trigger("add",this),c},readd(s){let c=this.children.indexOf(s);return c!==-1&&(this.children.splice(c,1),this.children.push(s)),s},remove(s){let c=this.children.indexOf(s);c!==-1&&(s.parent=null,s.trigger("destroy"),d.ev.trigger("destroy",s),this.children.splice(c,1))},removeAll(s){this.get(s).forEach(c=>this.remove(c))},update(){this.paused||(this.get().forEach(s=>s.update()),this.trigger("update"))},draw(){this.hidden||(ee(),k(this.pos),Te(this.scale),Ae(this.angle),this.trigger("draw"),this.get().forEach(s=>s.draw()),K())},drawInspect(){this.hidden||(ee(),k(this.pos),Te(this.scale),Ae(this.angle),this.get().forEach(s=>s.drawInspect()),this.trigger("drawInspect"),K())},use(s){if(!s)return;if(typeof s=="string")return this.use({id:s});s.id&&(this.unuse(s.id),t.set(s.id,{cleanups:[]}));let c=s.id?t.get(s.id):r,f=s.id?c.cleanups:[],m=l(()=>{if(s.require){for(let p of s.require)if(!this.c(p))throw new Error(`Component "${s.id}" requires component "${p}"`)}},"checkDeps");s.destroy&&f.push(s.destroy),s.require&&!this.exists()&&c.cleanups&&f.push(this.on("add",m));for(let p in s)if(!to.has(p)){if(typeof s[p]=="function"){let y=s[p].bind(this);if(no.has(p)){f.push(this.on(p,y)),c[p]=y;continue}else c[p]=y}else c[p]=s[p];if(this[p]===void 0)Object.defineProperty(this,p,{get:()=>c[p],set:y=>c[p]=y,configurable:!0,enumerable:!0});else throw new Error(`Duplicate component property: "${p}"`)}this.exists()&&(m(),s.add&&s.add.call(this))},unuse(s){if(t.has(s)){let c=t.get(s);c.cleanups.forEach(f=>f.cancel());for(let f in c)delete c[f]}t.delete(s)},c(s){return t.get(s)},get(s){return this.children.filter(c=>s?c.is(s):!0).sort((c,f)=>(c.z??0)-(f.z??0))},getAll(s){return this.children.sort((c,f)=>(c.z??0)-(f.z??0)).flatMap(c=>[c,...c.getAll(s)]).filter(c=>s?c.is(s):!0)},isAncestorOf(s){return s.parent?s.parent===this||this.isAncestorOf(s.parent):!1},exists(){return d.root.isAncestorOf(this)},is(s){if(s==="*")return!0;if(Array.isArray(s)){for(let c of s)if(!this.c(c))return!1;return!0}else return this.c(s)!=null},on(s,c){return u.on(s,c.bind(this))},trigger(s,...c){u.trigger(s,...c),d.objEvents.trigger(s,this,...c)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let s={};for(let[c,f]of t)s[c]=f.inspect?f.inspect():null;return s},onAdd(s){return this.on("add",s)},onUpdate(s){return this.on("update",s)},onDraw(s){return this.on("draw",s)},onDestroy(s){return this.on("destroy",s)},clearEvents(){u.clear()}};for(let s of e)h.use(s);return h}l(bn,"make");function De(e,t,r){return d.objEvents[e]||(d.objEvents[e]=new Ee),d.objEvents.on(e,(u,...h)=>{u.is(t)&&r(u,...h)})}l(De,"on");let Mt=l((e,t)=>{if(typeof e=="function"&&t===void 0){let r=We([{update:e}]);return{get paused(){return r.paused},set paused(u){r.paused=u},cancel:()=>r.destroy()}}else if(typeof e=="string")return De("update",e,t)},"onUpdate"),ii=l((e,t)=>{if(typeof e=="function"&&t===void 0){let r=We([{draw:e}]);return{get paused(){return r.hidden},set paused(u){r.hidden=u},cancel:()=>r.destroy()}}else if(typeof e=="string")return De("draw",e,t)},"onDraw");function vn(e,t){if(typeof e=="function"&&t===void 0)return d.ev.on("add",e);if(typeof e=="string")return De("add",e,t)}l(vn,"onAdd");function si(e,t){if(typeof e=="function"&&t===void 0)return d.ev.on("destroy",e);if(typeof e=="string")return De("destroy",e,t)}l(si,"onDestroy");function oi(e,t,r){return De("collide",e,(u,h,s)=>h.is(t)&&r(u,h,s))}l(oi,"onCollide");function ot(e,t){An(e).forEach(t),vn(e,t)}l(ot,"forAllCurrentAndFuture");function ai(e,t){if(typeof e=="function")return yn(e);{let r=[];return ot(e,u=>{if(!u.area)throw new Error("onClick() requires the object to have area() component");r.push(u.onClick(()=>t(u)))}),ut(r)}}l(ai,"onClick");function ui(e,t){let r=[];return ot(e,u=>{if(!u.area)throw new Error("onHover() requires the object to have area() component");r.push(u.onHover(()=>t(u)))}),ut(r)}l(ui,"onHover");function ci(e,t){let r=[];return ot(e,u=>{if(!u.area)throw new Error("onHoverUpdate() requires the object to have area() component");r.push(u.onHoverUpdate(()=>t(u)))}),ut(r)}l(ci,"onHoverUpdate");function hi(e,t){let r=[];return ot(e,u=>{if(!u.area)throw new Error("onHoverEnd() requires the object to have area() component");r.push(u.onHoverEnd(()=>t(u)))}),ut(r)}l(hi,"onHoverEnd");function at(e,t){let r=0,u=[];t&&u.push(t);let h=Mt(()=>{r+=te(),r>=e&&(h.cancel(),u.forEach(s=>s()))});return{paused:h.paused,cancel:h.cancel,onFinish(s){u.push(s)},then(s){return this.onFinish(s),this}}}l(at,"wait");function li(e,t){let r=null,u=l(()=>{r=at(e,u),t()},"newAction");return r=at(0,u),{get paused(){return r.paused},set paused(h){r.paused=h},cancel:()=>r.cancel()}}l(li,"loop");function ut(e){return{get paused(){return e[0].paused},set paused(t){e.forEach(r=>r.paused=t)},cancel:()=>e.forEach(t=>t.cancel())}}l(ut,"joinEventControllers");let di=l((e,t)=>{if(typeof e=="function")return d.ev.on("keyDown",e);if(typeof e=="string"&&typeof t=="function")return d.ev.on("keyDown",r=>r===e&&t(e))},"onKeyDown"),me=l((e,t)=>{if(typeof e=="function")return d.ev.on("keyPress",e);if(typeof e=="string"&&typeof t=="function")return d.ev.on("keyPress",r=>r===e&&t(e))},"onKeyPress"),fi=l((e,t)=>{if(typeof e=="function")return d.ev.on("keyPressRepeat",e);if(typeof e=="string"&&typeof t=="function")return d.ev.on("keyPressRepeat",r=>r===e&&t(e))},"onKeyPressRepeat"),mi=l((e,t)=>{if(typeof e=="function")return d.ev.on("keyRelease",e);if(typeof e=="string"&&typeof t=="function")return d.ev.on("keyRelease",r=>r===e&&t(e))},"onKeyRelease");function pi(e,t){return typeof e=="function"?d.ev.on("mouseDown",r=>e(r)):d.ev.on("mouseDown",r=>r===e&&t(r))}l(pi,"onMouseDown");function yn(e,t){return typeof e=="function"?d.ev.on("mousePress",r=>e(r)):d.ev.on("mousePress",r=>r===e&&t(r))}l(yn,"onMousePress");function gi(e,t){return typeof e=="function"?d.ev.on("mouseRelease",r=>e(r)):d.ev.on("mouseRelease",r=>r===e&&t(r))}l(gi,"onMouseRelease");function wi(e){return d.ev.on("mouseMove",()=>e(Pe(),mn()))}l(wi,"onMouseMove");function bi(e){return d.ev.on("charInput",e)}l(bi,"onCharInput");function vi(e){return d.ev.on("onTouchStart",e)}l(vi,"onTouchStart");function yi(e){return d.ev.on("onTouchMove",e)}l(yi,"onTouchMove");function Ui(e){return d.ev.on("onTouchEnd",e)}l(Ui,"onTouchEnd");function Ei(e){return d.ev.on("scroll",e)}l(Ei,"onScroll");function xi(e,t){return d.ev.on("virtualButtonDown",r=>r===e&&t())}l(xi,"onVirtualButtonDown");function Si(e,t){return d.ev.on("virtualButtonPress",r=>r===e&&t())}l(Si,"onVirtualButtonPress");function Ci(e,t){return d.ev.on("virtualButtonRelease",r=>r===e&&t())}l(Ci,"onVirtualButtonRelease");function Ti(e,t){if(typeof e=="function")return d.ev.on("gamepadButtonDown",e);if(typeof e=="string"&&typeof t=="function")return d.ev.on("gamepadButtonDown",r=>r===e&&t(e))}l(Ti,"onGamepadButtonDown");function Ai(e,t){if(typeof e=="function")return d.ev.on("gamepadButtonPress",e);if(typeof e=="string"&&typeof t=="function")return d.ev.on("gamepadButtonPress",r=>r===e&&t(e))}l(Ai,"onGamepadButtonPress");function Oi(e,t){if(typeof e=="function")return d.ev.on("gamepadButtonRelease",e);if(typeof e=="string"&&typeof t=="function")return d.ev.on("gamepadButtonRelease",r=>r===e&&t(e))}l(Oi,"onGamepadButtonRelease");function Un(){me("f1",()=>{L.inspect=!L.inspect}),me("f2",()=>{L.clearLog()}),me("f8",()=>{L.paused=!L.paused}),me("f7",()=>{L.timeScale=Xe(re(L.timeScale-.2,0,2),1)}),me("f9",()=>{L.timeScale=Xe(re(L.timeScale+.2,0,2),1)}),me("f10",()=>{L.stepFrame()})}l(Un,"enterDebugMode");function En(){me("b",()=>on())}l(En,"enterBurpMode");function Ri(e){return e!==void 0&&(d.gravity=e),d.gravity}l(Ri,"gravity");function ct(...e){return{id:"pos",pos:v(...e),moveBy(...t){this.pos=this.pos.add(v(...t))},move(...t){this.moveBy(v(...t).scale(te()))},moveTo(...t){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.moveTo(v(t[0],t[1]),t[2]);let r=t[0],u=t[1];if(u===void 0){this.pos=v(r);return}let h=r.sub(this.pos);if(h.len()<=u*te()){this.pos=v(r);return}this.move(h.unit().scale(u))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){return this.fixed?this.pos:Dt(this.pos)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){ge({color:S(255,0,0),radius:4/ln()})}}}l(ct,"pos");function ht(...e){return e.length===0?ht(1):{id:"scale",scale:v(...e),scaleTo(...t){this.scale=v(...t)},scaleBy(...t){this.scale.scale(v(...t))},inspect(){return`(${Xe(this.scale.x,2)}, ${Xe(this.scale.y,2)})`}}}l(ht,"scale");function Pi(e){return{id:"rotate",angle:e??0,rotateBy(t){this.angle+=t},rotateTo(t){this.angle=t},inspect(){return`${Math.round(this.angle)}`}}}l(Pi,"rotate");function Di(...e){return{id:"color",color:S(...e),inspect(){return this.color.toString()}}}l(Di,"color");function Xe(e,t){return Number(e.toFixed(t))}l(Xe,"toFixed");function Mi(e){return{id:"opacity",opacity:e??1,inspect(){return`${Xe(this.opacity,1)}`},fadeOut(t=1,r=et.linear){return Gt(this.opacity,0,t,u=>this.opacity=u,r)}}}l(Mi,"opacity");function Ft(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return typeof this.anchor=="string"?this.anchor:this.anchor.toString()}}}l(Ft,"anchor");function Fi(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}l(Fi,"z");function Bi(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??v(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}l(Bi,"follow");function Li(e,t){let r=typeof e=="number"?w.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(r.scale(t))}}}l(Li,"move");let Ii=200;function Gi(e={}){let t=e.distance??Ii,r=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let u=Dt(this.pos),h=new V(v(0),N(),j());return!Ve(h,u)&&h.sdistToPoint(u)>t*t},onExitScreen(u){return this.on("exitView",u)},onEnterScreen(u){return this.on("enterView",u)},update(){this.isOffScreen()?(r||(this.trigger("exitView"),r=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(r&&(this.trigger("enterView"),r=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))},inspect(){return`${this.isOffScreen()}`}}}l(Gi,"offscreen");function Vi(e={}){let t=[],r={},u=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&t.push(this.onHover(()=>pn(this.area.cursor))),t.push(this.onCollideUpdate((h,s)=>{r[h.id]||this.trigger("collide",h,s),r[h.id]=s,u.add(h.id)}))},update(){for(let h in r)u.has(Number(h))||(this.trigger("collideEnd",r[h].target),delete r[h]);u.clear()},drawInspect(){let h=this.localArea();ee(),Te(this.area.scale),k(this.area.offset);let s={outline:{width:4/ln(),color:S(0,0,255)},anchor:this.anchor,fill:!1,fixed:this.fixed};h instanceof V?W({...s,pos:h.pos,width:h.width,height:h.height}):h instanceof se?we({...s,pts:h.pts}):h instanceof de&&ge({...s,pos:h.center,radius:h.radius}),K()},destroy(){t.forEach(h=>h.cancel())},area:{shape:e.shape??null,scale:e.scale??v(1),offset:e.offset??v(0),cursor:e.cursor??null},isClicked(){return it()&&this.isHovering()},isHovering(){let h=this.fixed?Pe():wn(Pe());return this.hasPoint(h)},checkCollision(h){return this.colliding[h.id]??null},isColliding(h){return Boolean(r[h.id])},isOverlapping(h){let s=r[h.id];return s&&s.hasOverlap()},onClick(h){return this.onUpdate(()=>{this.isClicked()&&h()})},onHover(h){let s=!1;return this.onUpdate(()=>{s?s=this.isHovering():this.isHovering()&&(s=!0,h())})},onHoverUpdate(h){return this.onUpdate(()=>{this.isHovering()&&h()})},onHoverEnd(h){let s=!1;return this.onUpdate(()=>{s?this.isHovering()||(s=!1,h()):s=this.isHovering()})},onCollide(h,s){if(typeof h=="function"&&s===void 0)return this.on("collide",h);if(typeof h=="string")return this.onCollide((c,f)=>{c.is(h)&&s(c,f)})},onCollideUpdate(h,s){if(typeof h=="function"&&s===void 0)return this.on("collideUpdate",h);if(typeof h=="string")return this.on("collideUpdate",(c,f)=>c.is(h)&&s(c,f))},onCollideEnd(h,s){if(typeof h=="function"&&s===void 0)return this.on("collideEnd",h);if(typeof h=="string")return this.on("collideEnd",c=>c.is(h)&&s(c))},hasPoint(h){return $n(this.worldArea(),h)},pushOut(h){let s=this.checkCollision(h);s&&(this.pos=this.pos.add(s.displacement))},pushOutAll(){d.root.getAll().forEach(this.pushOut)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let h=this.localArea();if(!(h instanceof se||h instanceof V))throw new Error("Only support polygon and rect shapes for now");let s=this.transform.clone().scale(v(this.area.scale??1)).translate(this.area.offset);if(h instanceof V){let c=ke(this.anchor||vt).add(1,1).scale(-.5).scale(h.width,h.height);s.translate(c)}return h.transform(s)},screenArea(){let h=this.worldArea();return this.fixed?h:h.transform(d.cam.transform)}}}l(Vi,"area");function Ke(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,fixed:e.fixed,shader:e.shader,uniform:e.uniform}}l(Ke,"getRenderProps");function Bt(e,t={}){let r=null,u=null;if(!e)throw new Error("Please pass the resource name or data to sprite()");let h=l((s,c,f,m)=>{let p=v(1,1);return f&&m?(p.x=f/(s.width*c.w),p.y=m/(s.height*c.h)):f?(p.x=f/(s.width*c.w),p.y=p.x):m&&(p.y=m/(s.height*c.h),p.x=p.y),p},"calcTexScale");return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new G(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,draw(){if(!r)return;let s=r.frames[this.frame??0];if(!s)throw new Error(`Frame not found: ${this.frame??0}`);Ct(Object.assign(Ke(this),{tex:r.tex,quad:s,flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:t.width,height:t.height}))},update(){if(!r){let c=rn(e);if(!c||!c.data)return;let f=c.data.frames[0].clone();t.quad&&(f=f.scale(t.quad));let m=h(c.data.tex,f,t.width,t.height);this.width=c.data.tex.width*f.w*m.x,this.height=c.data.tex.height*f.h*m.y,t.anim&&this.play(t.anim),r=c.data,this.trigger("spriteLoaded",r)}if(!u)return;let s=r.anims[u.name];if(typeof s=="number"){this.frame=s;return}if(s.speed===0)throw new Error("Sprite anim speed cannot be 0");u.timer+=te()*this.animSpeed,u.timer>=1/u.speed&&(u.timer=0,s.from>s.to?(this.frame--,this.frame<s.to&&(u.loop?this.frame=s.from:(this.frame++,u.onEnd(),this.stop()))):(this.frame++,this.frame>s.to&&(u.loop?this.frame=s.from:(this.frame--,u.onEnd(),this.stop()))))},play(s,c={}){if(!r){this.on("spriteLoaded",()=>{this.play(s,c)});return}let f=r.anims[s];if(!f)throw new Error(`Anim not found: ${s}`);u&&this.stop(),u=typeof f=="number"?{name:s,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:s,timer:0,loop:c.loop??f.loop??!1,pingpong:c.pingpong??f.pingpong??!1,speed:c.speed??f.speed??10,onEnd:c.onEnd??(()=>{})},this.frame=typeof f=="number"?f:f.from,this.trigger("animStart",s)},stop(){if(!u)return;let s=u.name;u=null,this.trigger("animEnd",s)},numFrames(){return r?r.frames.length:0},curAnim(){return u?.name},onAnimEnd(s,c){return this.on("animEnd",f=>{f===s&&c()})},onAnimStart(s,c){return this.on("animStart",f=>{f===s&&c()})},renderArea(){return new V(v(0),this.width,this.height)},inspect(){if(typeof e=="string")return`"${e}"`}}}l(Bt,"sprite");function ji(e,t={}){function r(u){let h=be(Object.assign(Ke(u),{text:u.text+"",size:u.textSize,font:u.font,width:t.width&&u.width,align:u.align,letterSpacing:u.letterSpacing,lineSpacing:u.lineSpacing,transform:u.textTransform,styles:u.textStyles}));return t.width||(u.width=h.width/(u.scale?.x||1)),u.height=h.height/(u.scale?.y||1),h}return l(r,"update"),{id:"text",text:e,textSize:t.size??Js,font:t.font,width:t.width,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,add(){Lt(()=>r(this))},draw(){ve(r(this))},renderArea(){return new V(v(0),this.width,this.height)}}}l(ji,"text");function ki(e,t,r={}){return{id:"rect",width:e,height:t,radius:r.radius||0,draw(){W(Object.assign(Ke(this),{width:this.width,height:this.height,radius:this.radius}))},renderArea(){return new V(v(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}l(ki,"rect");function _i(e,t){return{id:"rect",width:e,height:t,draw(){Oe(Object.assign(Ke(this),{width:this.width,height:this.height}))},renderArea(){return new V(v(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}l(_i,"uvquad");function Ni(e){return{id:"circle",radius:e,draw(){ge(Object.assign(Ke(this),{radius:this.radius}))},renderArea(){return new V(new w(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}l(Ni,"circle");function Hi(e=1,t=S(0,0,0)){return{id:"outline",outline:{width:e,color:t}}}l(Hi,"outline");function xn(e,t){let r=new Ee;return e&&t&&r.pushd(new pe(e,t)),{id:"timer",wait(u,h){let s=[h],c=new pe(u,()=>s.forEach(m=>m())),f=r.pushd(c);return{get paused(){return c.paused},set paused(m){c.paused=m},cancel:f,onFinish(m){s.push(m)},then(m){return this.onFinish(m),this}}},update(){r.forEach((u,h)=>{u.tick(te())&&r.delete(h)})}}}l(xn,"timer");let qi=640,$i=65536;function zi(e={}){let t=0,r=null,u=null,h=!1,s=[];return{id:"body",require:["pos","area"],jumpForce:e.jumpForce??qi,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");s.push(this.onCollideUpdate((c,f)=>{if(!!c.is("body")&&!f.resolved&&(this.trigger("beforePhysicsResolve",f),c.trigger("beforePhysicsResolve",f.reverse()),!f.resolved&&!(this.isStatic&&c.isStatic))){if(!this.isStatic&&!c.isStatic){let m=this.mass+c.mass;this.pos=this.pos.add(f.displacement.scale(c.mass/m)),c.pos=c.pos.add(f.displacement.scale(-this.mass/m)),this.transform=st(this),c.transform=st(c)}else{let m=!this.isStatic&&c.isStatic?f:f.reverse();m.source.pos=m.source.pos.add(m.displacement),m.source.transform=st(m.source)}f.resolved=!0,this.trigger("physicsResolve",f),c.trigger("physicsResolve",f.reverse())}})),s.push(this.onPhysicsResolve(c=>{d.gravity&&(c.isBottom()&&this.isFalling()?(t=0,r=c.target,u=c.target.pos,h?h=!1:this.trigger("ground",r)):c.isTop()&&this.isJumping()&&(t=0,this.trigger("headbutt",c.target)))}))},update(){if(!d.gravity||this.isStatic)return;if(h&&(r=null,u=null,this.trigger("fallOff"),h=!1),r)if(!this.isColliding(r)||!r.exists()||!r.is("body"))h=!0;else{!r.pos.eq(u)&&e.stickToPlatform!==!1&&this.moveBy(r.pos.sub(u)),u=r.pos;return}let c=t;t+=d.gravity*this.gravityScale*te(),t=Math.min(t,e.maxVelocity??$i),c<0&&t>=0&&this.trigger("fall"),this.move(0,t)},destroy(){s.forEach(c=>c.cancel())},onPhysicsResolve(c){return this.on("physicsResolve",c)},onBeforePhysicsResolve(c){return this.on("beforePhysicsResolve",c)},curPlatform(){return r},isGrounded(){return r!==null},isFalling(){return t>0},isJumping(){return t<0},jump(c){r=null,u=null,t=-c||-this.jumpForce},onGround(c){return this.on("ground",c)},onFall(c){return this.on("fall",c)},onFallOff(c){return this.on("fallOff",c)},onHeadbutt(c){return this.on("headbutt",c)}}}l(zi,"body");function Yi(e=2){let t=e,r=[];return{id:"doubleJump",require:["body"],numJumps:e,add(){r.push(this.onGround(()=>{t=this.numJumps}))},destroy(){r.forEach(u=>u.cancel())},doubleJump(u){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(u))},onDoubleJump(u){return this.on("doubleJump",u)},inspect(){return`${t}`}}}l(Yi,"doubleJump");function Xi(e,t={}){return{id:"shader",shader:e,uniform:t}}l(Xi,"shader");function Ki(){return{id:"fixed",fixed:!0}}l(Ki,"fixed");function Sn(e){return{id:"stay",stay:!0,scenesToStay:e}}l(Sn,"stay");function Wi(e){if(e==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(t=1){this.setHP(e-t),this.trigger("hurt")},heal(t=1){this.setHP(e+t),this.trigger("heal")},hp(){return e},setHP(t){e=t,e<=0&&this.trigger("death")},onHurt(t){return this.on("hurt",t)},onHeal(t){return this.on("heal",t)},onDeath(t){return this.on("death",t)},inspect(){return`${e}`}}}l(Wi,"health");function Ji(e,t={}){if(e==null)throw new Error("lifespan() requires time");let r=t.fade??0;return{id:"lifespan",async add(){await at(e),r>0&&this.opacity&&await Gt(this.opacity,0,r,u=>this.opacity=u,et.linear),this.destroy()}}}l(Ji,"lifespan");function Qi(e,t,r){if(!e)throw new Error("state() requires an initial state");let u={};function h(m){u[m]||(u[m]={enter:new Z,end:new Z,update:new Z,draw:new Z})}l(h,"initStateEvents");function s(m,p,y){return h(p),u[p][m].add(y)}l(s,"on");function c(m,p,...y){h(p),u[p][m].trigger(...y)}l(c,"trigger");let f=!1;return{id:"state",state:e,enterState(m,...p){if(f=!0,t&&!t.includes(m))throw new Error(`State not found: ${m}`);let y=this.state;if(r){if(!r?.[y])return;let U=typeof r[y]=="string"?[r[y]]:r[y];if(!U.includes(m))throw new Error(`Cannot transition state from "${y}" to "${m}". Available transitions: ${U.map(M=>`"${M}"`).join(", ")}`)}c("end",y,...p),this.state=m,c("enter",m,...p),c("enter",`${y} -> ${m}`,...p)},onStateTransition(m,p,y){return s("enter",`${m} -> ${p}`,y)},onStateEnter(m,p){return s("enter",m,p)},onStateUpdate(m,p){return s("update",m,p)},onStateDraw(m,p){return s("draw",m,p)},onStateEnd(m,p){return s("end",m,p)},update(){f||(c("enter",e),f=!0),c("update",this.state)},draw(){c("draw",this.state)},inspect(){return this.state}}}l(Qi,"state");function Zi(e=1){let t=0,r=!1;return{require:["opacity"],add(){this.opacity=0},update(){r||(t+=te(),this.opacity=pt(t,0,e,0,1),t>=e&&(this.opacity=1,r=!0))}}}l(Zi,"fadeIn");function Lt(e){x.loaded?e():d.ev.on("load",e)}l(Lt,"onLoad");function es(e,t){d.scenes[e]=t}l(es,"scene");function ts(e,...t){if(!d.scenes[e])throw new Error(`Scene not found: ${e}`);d.ev.onOnce("frameEnd",()=>{d.ev=new he,d.objEvents=new he,d.root.get().forEach(r=>{(!r.stay||r.scenesToStay&&!r.scenesToStay.includes(e))&&d.root.remove(r)}),d.root.clearEvents(),d.cam={pos:null,scale:v(1),angle:0,shake:0,transform:new I},d.gravity=0,d.scenes[e](...t),i.debug!==!1&&Un(),i.burp&&En()})}l(ts,"go");function ns(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(Cn(e,t),t):null}}l(ns,"getData");function Cn(e,t){window.localStorage[e]=JSON.stringify(t)}l(Cn,"setData");function Tn(e){let t=e(Me);for(let r in t)Me[r]=t[r],i.global!==!1&&(window[r]=t[r]);return Me}l(Tn,"plug");function lt(){return v(N()/2,j()/2)}l(lt,"center");function rs(e,t){return{id:"tile",tilePos:t.clone(),setTilePos(...r){let u=v(...r);this.tilePos=u.clone(),this.pos=v(this.tilePos.x*e.tileWidth(),this.tilePos.y*e.tileHeight())},moveLeft(){this.setTilePos(this.tilePos.add(v(-1,0)))},moveRight(){this.setTilePos(this.tilePos.add(v(1,0)))},moveUp(){this.setTilePos(this.tilePos.add(v(0,-1)))},moveDown(){this.setTilePos(this.tilePos.add(v(0,1)))}}}l(rs,"tile");function is(){return{id:"obstacle",require:["tile"],isObstacle:!0}}l(is,"obstacle");function ss(e,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let r=We([ct(t.pos??v(0))]),u=e.length,h=0,s={id:"level",tileWidth(){return t.tileWidth},tileHeight(){return t.tileHeight},getPos(...c){let f=v(...c);return v(f.x*t.tileWidth,f.y*t.tileHeight)},spawn(c,...f){let m=v(...f),p=(()=>{if(t.tiles[c]){if(typeof t.tiles[c]!="function")throw new Error("Level symbol def must be a function returning a component list");return t.tiles[c](m)}else if(t.wildcardTile)return t.wildcardTile(c,m)})();if(!p)return;let y=v(m.x*t.tileWidth,m.y*t.tileHeight);for(let U of p)if(U.id==="pos"){y.x+=U.pos.x,y.y+=U.pos.y;break}return p.push(ct(y)),p.push(rs(this,m)),r.add(p)},numColumns(){return h},numRows(){return u},levelWidth(){return h*t.tileWidth},levelHeight(){return u*t.tileHeight}};return r.use(s),e.forEach((c,f)=>{let m=c.split("");h=Math.max(m.length,h),m.forEach((p,y)=>{r.spawn(p,v(y,f))})}),r}l(ss,"addLevel");function os(e){let t=a.canvas.captureStream(e),r=T.ctx.createMediaStreamDestination();T.masterNode.connect(r);let u=new MediaRecorder(t),h=[];return u.ondataavailable=s=>{s.data.size>0&&h.push(s.data)},u.onerror=()=>{T.masterNode.disconnect(r),t.getTracks().forEach(s=>s.stop())},u.start(),{resume(){u.resume()},pause(){u.pause()},stop(){return u.stop(),T.masterNode.disconnect(r),t.getTracks().forEach(s=>s.stop()),new Promise(s=>{u.onstop=()=>{s(new Blob(h,{type:"video/mp4"}))}})},download(s="kaboom.mp4"){this.stop().then(c=>qt(s,c))}}}l(os,"record");function as(){return document.activeElement===a.canvas}l(as,"isFocused");function us(e){e.destroy()}l(us,"destroy");let We=d.root.add.bind(d.root),cs=d.root.readd.bind(d.root),hs=d.root.removeAll.bind(d.root),An=d.root.get.bind(d.root),On=d.root.getAll.bind(d.root);function Rn(e=2,t=1){let r=0;return{id:"boom",require:["scale"],update(){let u=Math.sin(r*e)*t;u<0&&this.destroy(),this.scale=v(u),r+=te()}}}l(Rn,"boom");let ls=Ce(null,er),ds=Ce(null,tr);function fs(e,t={}){let r=We([ct(e),Sn()]),u=(t.speed||1)*5,h=t.scale||1;r.add([Bt(ds),ht(0),Ft("center"),Rn(u,h),...t.comps??[]]);let s=r.add([Bt(ls),ht(0),Ft("center"),xn(.4/u,()=>s.use(Rn(u,h))),...t.comps??[]]);return s.onDestroy(()=>r.destroy()),r}l(fs,"addKaboom");function ms(){d.ev.trigger("input"),a.keyState.down.forEach(e=>d.ev.trigger("keyDown",e)),a.mouseState.down.forEach(e=>d.ev.trigger("mouseDown",e)),a.virtualButtonState.down.forEach(e=>d.ev.trigger("virtualButtonDown",e));for(let e of navigator.getGamepads());}l(ms,"inputFrame");function Pn(){d.root.update()}l(Pn,"updateFrame");let ps=64;class dt{source;target;displacement;resolved=!1;constructor(t,r,u,h=!1){this.source=t,this.target=r,this.displacement=u,this.resolved=h}reverse(){return new dt(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}l(dt,"Collision");function gs(){let e={},t=i.hashGridSize||ps,r=new I,u=[];function h(s){if(u.push(r.clone()),s.pos&&r.translate(s.pos),s.scale&&r.scale(s.scale),s.angle&&r.rotate(s.angle),s.transform=r.clone(),s.c("area")&&!s.paused){let c=s,m=c.worldArea().bbox(),p=Math.floor(m.pos.x/t),y=Math.floor(m.pos.y/t),U=Math.ceil((m.pos.x+m.width)/t),M=Math.ceil((m.pos.y+m.height)/t),P=new Set;for(let H=p;H<=U;H++)for(let $=y;$<=M;$++)if(!e[H])e[H]={},e[H][$]=[c];else if(!e[H][$])e[H][$]=[c];else{let ye=e[H][$];e:for(let J of ye){if(!J.exists()||P.has(J.id))continue;for(let A of c.collisionIgnore)if(J.is(A))continue e;for(let A of J.collisionIgnore)if(c.is(A))continue e;let q=zn(c.worldArea(),J.worldArea());if(q){let A=new dt(c,J,q);c.trigger("collideUpdate",J,A);let _=A.reverse();_.resolved=A.resolved,J.trigger("collideUpdate",c,_)}P.add(J.id)}ye.push(c)}}s.get().forEach(h),r=u.pop()}l(h,"checkObj"),h(d.root)}l(gs,"checkFrame");function ws(){let e=d.cam,t=w.fromAngle(Ze(0,360)).scale(e.shake);e.shake=Ge(e.shake,0,5*te()),e.transform=new I().translate(lt()).scale(e.scale).rotate(e.angle).translate((e.pos??lt()).scale(-1).add(t)),d.root.draw(),le()}l(ws,"drawFrame");function bs(){let e=oe();ae(()=>{let t=N()/2,r=24,u=v(N()/2,j()/2).sub(v(t/2,r/2));W({pos:v(0),width:N(),height:j(),color:S(0,0,0)}),W({pos:u,width:t,height:r,fill:!1,outline:{width:4}}),W({pos:u,width:t*e,height:r})}),d.ev.trigger("loading",e)}l(bs,"drawLoadScreen");function Dn(e,t){ae(()=>{let r=v(8);ee(),k(e);let u=be({text:t,font:yt,size:16,pos:r,color:S(255,255,255),fixed:!0}),h=u.width+r.x*2,s=u.height+r.x*2;e.x+h>=N()&&k(v(-h,0)),e.y+s>=j()&&k(v(0,-s)),W({width:h,height:s,color:S(0,0,0),radius:4,opacity:.8,fixed:!0}),ve(u),K()})}l(Dn,"drawInspectText");function vs(){if(L.inspect){let e=null;for(let t of On())if(t.c("area")&&t.isHovering()){e=t;break}if(d.root.drawInspect(),e){let t=[],r=e.inspect();for(let u in r)r[u]?t.push(`${u}: ${r[u]}`):t.push(`${u}`);Dn(_r(Pe()),t.join(`
`))}Dn(v(8),`FPS: ${L.fps()}`)}L.paused&&ae(()=>{ee(),k(N(),0),k(-8,8);let e=32;W({width:e,height:e,anchor:"topright",color:S(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=1;t<=2;t++)W({width:4,height:e*.6,anchor:"center",pos:v(-e/3*t,e*.5),color:S(255,255,255),radius:2,fixed:!0});K()}),L.timeScale!==1&&ae(()=>{ee(),k(N(),j()),k(-8,-8);let e=8,t=be({text:L.timeScale.toFixed(1),font:yt,size:16,color:S(255,255,255),pos:v(-e),anchor:"botright",fixed:!0});W({width:t.width+e*2+e*4,height:t.height+e*2,anchor:"botright",color:S(0,0,0),opacity:.8,radius:4,fixed:!0});for(let r=0;r<2;r++){let u=L.timeScale<1;un({p1:v(-t.width-e*(u?2:3.5),-e),p2:v(-t.width-e*(u?2:3.5),-e-t.height),p3:v(-t.width-e*(u?3.5:2),-e-t.height/2),pos:v(-r*e*1+(u?-e*.5:0),0),color:S(255,255,255),fixed:!0})}ve(t),K()}),L.curRecording&&ae(()=>{ee(),k(0,j()),k(24,-24),ge({radius:12,color:S(255,0,0),opacity:kt(0,1,Rt()*4),fixed:!0}),K()}),L.showLog&&d.logs.length>0&&ae(()=>{ee(),k(0,j()),k(8,-8);let e=8,t=be({text:d.logs.join(`
`),font:yt,pos:v(e,-e),anchor:"botleft",size:16,width:N()*.6,lineSpacing:e/2,fixed:!0,styles:{time:{color:S(127,127,127)},info:{color:S(255,255,255)},error:{color:S(255,0,127)}}});W({width:t.width+e*2,height:t.height+e*2,anchor:"botleft",color:S(0,0,0),radius:4,opacity:.8,fixed:!0}),ve(t),K()})}l(vs,"drawDebug");function ys(){let e=Pe(),t=l((u,h,s)=>{ge({radius:80/2,pos:u,outline:{width:4,color:S(0,0,0)},opacity:.5,fixed:!0}),s&&rt({text:s,pos:u,color:S(0,0,0),size:40,anchor:"center",opacity:.5,fixed:!0}),it("left")&&qn(new de(u,80/2),e)&&d.ev.onOnce("input",()=>{a.virtualButtonState.press(h),d.ev.trigger("virtualButtonPress",h),a.keyState.press(h),d.ev.trigger("keyPress",h)}),Ot("left")&&d.ev.onOnce("input",()=>{a.virtualButtonState.release(h),d.ev.trigger("virtualButtonRelease",h),a.keyState.release(h),d.ev.trigger("keyRelease",h)})},"drawCircleButton"),r=l((u,h,s)=>{W({width:64,height:64,pos:u,outline:{width:4,color:S(0,0,0)},radius:4,anchor:"center",opacity:.5,fixed:!0}),s&&rt({text:s,pos:u,color:S(0,0,0),size:40,anchor:"center",opacity:.5,fixed:!0}),it("left")&&Ve(new V(u.add(-64/2,-64/2),64,64),e)&&d.ev.onOnce("input",()=>{a.virtualButtonState.press(h),d.ev.trigger("virtualButtonPress",h),a.keyState.press(h),d.ev.trigger("keyPress",h)}),Ot("left")&&d.ev.onOnce("input",()=>{a.virtualButtonState.release(h),d.ev.trigger("virtualButtonRelease",h),a.keyState.release(h),d.ev.trigger("keyRelease",h)})},"drawSquareButton");ae(()=>{t(v(N()-80,j()-160),"a"),t(v(N()-160,j()-80),"b"),r(v(60,j()-124),"left"),r(v(188,j()-124),"right"),r(v(124,j()-188),"up"),r(v(124,j()-60),"down")})}l(ys,"drawVirtualControls"),i.debug!==!1&&Un(),i.burp&&En();function Us(e){d.ev.on("loading",e)}l(Us,"onLoadUpdate");function Es(e){d.ev.on("resize",e)}l(Es,"onResize");function xs(e){d.ev.on("error",e)}l(xs,"onError");function It(e){Mn(()=>{ae(()=>{let u=N(),h=j(),s={size:36,width:u-32*2,letterSpacing:4,lineSpacing:4,font:yt,fixed:!0};W({width:u,height:h,color:S(0,0,255),fixed:!0});let c=be({...s,text:e.name,pos:v(32),color:S(255,128,0),fixed:!0});ve(c),rt({...s,text:e.message,pos:v(32,32+c.height+16),fixed:!0}),K(),d.ev.trigger("error",e)})})}l(It,"handleErr");function Ss(){a.keyState.update(),a.mouseState.update(),a.virtualButtonState.update(),a.charInputted=[],a.isMouseMoved=!1}l(Ss,"resetInputState");function Mn(e){a.loopID!==null&&cancelAnimationFrame(a.loopID);let t=l(r=>{if(a.stopped)return;if(document.visibilityState!=="visible"){a.loopID=requestAnimationFrame(t);return}let u=r/1e3,h=u-a.realTime;a.realTime=u,a.skipTime||(a.dt=h,a.time+=te(),a.fpsCounter.tick(a.dt)),a.skipTime=!1,a.numFrames++,Dr(),e(),Fr(),Ss(),d.ev.trigger("frameEnd"),a.loopID=requestAnimationFrame(t)},"frame");t(0)}l(Mn,"run");function Cs(){d.ev.onOnce("frameEnd",()=>{a.stopped=!0,o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT|o.STENCIL_BUFFER_BIT);let e=o.getParameter(o.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)o.activeTexture(o.TEXTURE0+t),o.bindTexture(o.TEXTURE_2D,null),o.bindTexture(o.TEXTURE_CUBE_MAP,null);o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),n.forEach(t=>t()),o.deleteBuffer(g.vbuf),o.deleteBuffer(g.ibuf);for(let t in Y)a.canvas.removeEventListener(t,Y[t]);for(let t in ze)document.removeEventListener(t,ze[t]);for(let t in Re)window.removeEventListener(t,Re[t])})}l(Cs,"quit");function Gt(e,t,r,u,h=et.linear){let s=0,c=[],f=Mt(()=>{s+=te();let m=Math.min(s/r,1);u(Ge(e,t,h(m))),m===1&&(f.cancel(),u(t),c.forEach(p=>p()))});return{get paused(){return f.paused},set paused(m){f.paused=m},onFinish(m){c.push(m)},then(m){return this.onFinish(m),this},cancel(){f.cancel()},finish(){f.cancel(),u(t),c.forEach(m=>m())}}}l(Gt,"tween");let ft=!0;Mn(()=>{x.loaded||oe()===1&&!ft&&(x.loaded=!0,d.ev.trigger("load")),!x.loaded&&i.loadingScreen!==!1||ft?bs():(ms(),L.paused||Pn(),gs(),ws(),i.debug!==!1&&vs(),i.virtualControls&&gn()&&ys()),ft&&(ft=!1)});let Me={VERSION:qs,loadRoot:tt,loadProgress:oe,loadSprite:Ce,loadSpriteAtlas:Jt,loadSound:Sr,loadBitmapFont:vr,loadFont:Ne,loadShader:Er,loadShaderURL:xr,loadAseprite:Ur,loadPedit:yr,loadBean:Cr,load:z,getSprite:Zt,getSound:en,getFont:Tr,getBitmapFont:tn,getShader:nn,Asset:R,SpriteData:O,SoundData:F,width:N,height:j,center:lt,dt:te,time:Rt,screenshot:Qr,record:os,isFocused:as,setCursor:pn,setFullscreen:Zr,isFullscreen:Pt,isTouchScreen:gn,onLoad:Lt,onLoadUpdate:Us,onResize:Es,onError:xs,camPos:ei,camScale:ti,camRot:ni,shake:ri,toScreen:Dt,toWorld:wn,gravity:Ri,add:We,destroy:us,destroyAll:hs,get:An,getAll:On,readd:cs,pos:ct,scale:ht,rotate:Pi,color:Di,opacity:Mi,anchor:Ft,area:Vi,sprite:Bt,text:ji,rect:ki,circle:Ni,uvquad:_i,outline:Hi,body:zi,doubleJump:Yi,shader:Xi,timer:xn,fixed:Ki,stay:Sn,health:Wi,lifespan:Ji,z:Fi,move:Li,offscreen:Gi,follow:Bi,state:Qi,fadeIn:Zi,obstacle:is,on:De,onUpdate:Mt,onDraw:ii,onAdd:vn,onDestroy:si,onCollide:oi,onClick:ai,onHover:ui,onHoverUpdate:ci,onHoverEnd:hi,onKeyDown:di,onKeyPress:me,onKeyPressRepeat:fi,onKeyRelease:mi,onMouseDown:pi,onMousePress:yn,onMouseRelease:gi,onMouseMove:wi,onCharInput:bi,onTouchStart:vi,onTouchMove:yi,onTouchEnd:Ui,onScroll:Ei,onVirtualButtonPress:Si,onVirtualButtonDown:xi,onVirtualButtonRelease:Ci,onGamepadButtonDown:Ti,onGamepadButtonPress:Ai,onGamepadButtonRelease:Oi,mousePos:Pe,mouseDeltaPos:mn,isKeyDown:zr,isKeyPressed:qr,isKeyPressedRepeat:$r,isKeyReleased:Yr,isMouseDown:Nr,isMousePressed:it,isMouseReleased:Ot,isMouseMoved:Hr,isVirtualButtonPressed:Xr,isVirtualButtonDown:Kr,isVirtualButtonReleased:Wr,charInputted:Jr,loop:li,wait:at,play:He,volume:Rr,burp:on,audioCtx:T.ctx,Timer:pe,Line:ne,Rect:V,Circle:de,Polygon:se,Vec2:w,Color:C,Mat4:I,Quad:G,RNG:Ie,rand:Ze,randi:_t,randSeed:jn,vec2:v,rgb:S,hsl2rgb:Gn,quad:Vn,choose:_n,chance:kn,lerp:Ge,tween:Gt,easings:et,map:pt,mapc:In,wave:kt,deg2rad:ce,rad2deg:mt,testLineLine:Le,testRectRect:Nn,testRectLine:Hn,testRectPoint:Ve,drawSprite:Ir,drawText:rt,formatText:be,drawRect:W,drawLine:$e,drawLines:an,drawTriangle:un,drawCircle:ge,drawEllipse:cn,drawUVQuad:Oe,drawPolygon:we,drawFormattedText:ve,drawMasked:Gr,drawSubtracted:Vr,pushTransform:ee,popTransform:K,pushTranslate:k,pushScale:Te,pushRotate:Ae,pushMatrix:Lr,usePostEffect:Mr,debug:L,scene:es,go:ts,addLevel:ss,getData:ns,setData:Cn,download:bt,downloadJSON:Jn,downloadText:Ht,downloadBlob:qt,plug:Tn,ASCII_CHARS:ir,canvas:a.canvas,addKaboom:fs,LEFT:w.LEFT,RIGHT:w.RIGHT,UP:w.UP,DOWN:w.DOWN,RED:C.RED,GREEN:C.GREEN,BLUE:C.BLUE,YELLOW:C.YELLOW,MAGENTA:C.MAGENTA,CYAN:C.CYAN,WHITE:C.WHITE,BLACK:C.BLACK,quit:Cs,Event:Z,EventHandler:he};if(i.plugins&&i.plugins.forEach(Tn),i.global!==!1)for(let e in Me)window[e]=Me[e];return a.canvas.focus(),Me},"default");
//# sourceMappingURL=kaboom.cjs.map
